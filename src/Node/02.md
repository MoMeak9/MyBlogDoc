---
icon: edit
date: 2022-04-08
category:
- Node
---

# Node 笔记（2）

## 模块化



## CommonJS和Node



## exports导出

exports是一个对象，我们可以在这个对象中添加很多个属性，添加的属性会导出；

```js
exports.name = 'name';
exports.age = 'age';
exports.sayHello = 'sayHello';
```

另外一个文件中可以导入：

```js
const bar = require('./bar');
```

上面这行完成了什么操作呢？

- 意味着main中的bar变量等于exports对象；
- 也就是require通过各种查找方式，最终找到了exports这个对象；
- 并且将这个exports对象赋值给了bar变量；
- bar变量就是exports对象了；

### 它们实际上是一个浅层拷贝

- **bar对象是exports对象的浅拷贝（引用赋值）；**
- 浅拷贝的本质就是一种引用的赋值而已；

![image-20220408201318574](https://mc-web-1259409954.cos.ap-guangzhou.myqcloud.com/MyImages/202204082013660.png)

## module.exports又是什么？

**在Node中真正用于导出的其实根本不是exports，而是module.exports；**CommonJS中是没有module.exports的概念的；但是为了实现模块的导出，Node中使用的是Module的类，每一个模块都是Module的一个实例，也就是 module；

**为什么exports也可以导出呢？**

这是因为module对象的exports属性是exports对象的一个引用；

也就是说 `module.exports = exports = main中的bar`；

## 模块的加载过程

- 模块在被第一次引入时，模块中的js代码会被运行一次

- 模块被多次引入时，会缓存，**最终只加载（运行）一次**

  这是因为每个模块对象module都有一个属性：loaded。为false表示还没有加载，为true表示已经加载；

- 如果有循环引入，那么加载顺序是采取深度优先算法

main -> aaa -> ccc -> ddd -> eee ->bbb

![image-20220408203317949](https://mc-web-1259409954.cos.ap-guangzhou.myqcloud.com/MyImages/202204082033004.png)

## CommonJS规范缺点

**CommonJS加载模块是同步的：**

- 同步的意味着只有等到对应的模块加载完毕，当前模块中的内容才能被运行；
- 这个在服务器不会有什么问题，因为服务器加载的js文件都是本地文件，加载速度非常快；

**如果将它应用于浏览器呢？**

- 浏览器加载js文件需要先从服务器将文件下载下来，之后在加载运行；
- 那么采用同步的就意味着后续的js代码都无法正常运行，即使是一些简单的DOM操作；所以在浏览器中，我们通常不使用CommonJS规范；

**在早期为了可以在浏览器中使用模块化，通常会采用AMD或CMD**

- 但是目前一方面现代的浏览器已经支持ES Modules，另一方面借助于webpack等工具可以实现对CommonJS或者 ES Module代码的转换；

## AMD规范

![image-20220408203759224](https://mc-web-1259409954.cos.ap-guangzhou.myqcloud.com/MyImages/202204082037402.png)

## CMD规范

![image-20220408203810211](https://mc-web-1259409954.cos.ap-guangzhou.myqcloud.com/MyImages/202204082038316.png)

## ES Module



### export关键字



### import关键字



### Export和import结合使用



### default用法



### import函数



## CommonJS的加载过程





## ES Module加载过程





## CommonJS和ES Module交互

**通常情况下，CommonJS不能加载ES Module**

- 因为CommonJS是同步加载的，但是ES Module必须经过静态分析等，无法在这个时候执行JavaScript代码；Node当中是不支持的；

**多数情况下，ES Module可以加载CommonJS**

- ES Module在加载CommonJS时，会将其module.exports导出的内容作为default导出方式来使用；
- 这个依然需要看具体的实现，比如webpack中是支持的、Node最新的Current版本也是支持的；但是在最新的LTS版本中就不支持







