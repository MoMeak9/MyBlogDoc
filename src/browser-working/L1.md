---
icon: edit
date: 2022-03-19
category:
- 面经
- PDD
---

# 浏览器基础

## 进程和线程

不过，在介绍进程和线程之前，我需要先讲解下什么是并行处理，因为如果你理解了并行处理的概念，那么再理解进程和线程之间的关系就会变得轻松许多。

### 什么是并行处理

计算机中的并行处理就是同一时刻处理多个任务，比如我们要计算下面这三个表达式的值，并显示出结果

### 线程 VS 进程

一个进程就是一个程序的运行实例。详细解释就是，启动一个程序的时候，操作系统会为该程序创建一块内存（最小内存分配单元），用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的一个运行环境叫进程。

![](https://mc-web-1259409954.cos.ap-guangzhou.myqcloud.com/MyImages/3380f0a16c323deda5d3a300804b95da.png)

从图中可以看到，线程是依附于进程的，而进程中使用多线程并行处理能提升运算效率。

总结来说，进程和线程之间的关系有以下4个特点

**1. 进程中的任意一线程执行出错，都会导致整个进程的崩溃。**

**2. 线程之间共享进程中的数据。**

线程之间可以对进程的公共数据进行读写操作。

![](https://mc-web-1259409954.cos.ap-guangzhou.myqcloud.com/MyImages/d0efacd7f299ed99e776cb97da2a799e.png)

**3. 当一个进程关闭之后，操作系统会回收进程所占用的内存。**

**4. 进程之间的内容相互隔离。**

## 单进程浏览器时代

在了解了进程和线程之后，我们再来一起看下单进程浏览器的架构。顾名思义，单进程浏览器是指浏览器的所有功能模块都是运行在同一个进程里，这些模块包含了网络、插件、JavaScript运行环境、渲染引擎和页面等。其实早在2007年之前，市面上浏览器都是单进程的。单进程浏览器的架构如下图所示

![](https://mc-web-1259409954.cos.ap-guangzhou.myqcloud.com/MyImages/6ddad2419b049b0eb2a8036f3dfff1ca.png)

### 目前多进程架构

不过Chrome的发展是滚滚向前的，相较之前，目前的架构又有了很多新的变化。我们先看看最新的Chrome进程架构，你可以参考下图

![](https://mc-web-1259409954.cos.ap-guangzhou.myqcloud.com/MyImages/b61cab529fa31301bde290813b4587fc.png)

从图中可以看出，最新的Chrome浏览器包括：**<u>1个浏览器（Browser）主进程、1个 GPU 进程、1个网络（NetWork）进程、多个渲染进程和多个插件进程</u>**

**主、G、网、渲插**

下面我们来逐个分析下这几个进程的功能。

- **浏览器进程**。主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。
- **渲染进程**。核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，排版引擎Blink和JavaScript引擎V8都是运行在该进程中，默认情况下，Chrome会为每个Tab标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。
- **GPU进程**。其实，Chrome刚开始发布的时候是没有GPU进程的。而GPU的使用初衷是为了实现3D CSS的效果，只是随后网页、**Chrome的UI界面都选择采用GPU来绘制，这使得GPU成为浏览器普遍的需求。最后，Chrome在其多进程架构上也引入了GPU进程**。
- **网络进程**。主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立出来，成为一个单独的进程。
- **插件进程**。主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响

讲到这里，现在你应该就可以回答文章开头提到的问题了：仅仅打开了1个页面，为什么有4个进程？因为打开1个**页面至少需要1个网络进程、1个浏览器进程、1个GPU进程以及1个渲染进程**，共4个；如果打开的页面有运行插件的话，还需要再加上**1个插件进程。**

不过凡事都有两面性，虽然多进程模型提升了浏览器的稳定性、流畅性和安全性，但同样不可避免地带来了一些问题

- **更高的资源占用**。因为每个进程都会包含公共基础结构的副本（如JavaScript运行环境），这就意味着浏览器会消耗更多的内存资源。
- **更复杂的体系架构**。浏览器各模块之间耦合性高、扩展性差等问题，会导致现在的架构已经很难适应新的需求了

对于上面这两个问题，Chrome团队一直在寻求一种弹性方案，既可以解决资源占用高的问题，也可以解决复杂的体系架构的问题

### 未来面向服务的架构

为了解决这些问题，在2016年，Chrome官方团队使用**“面向服务的架构”（Services Oriented Architecture，简称SOA）**的思想设计了新的Chrome架构。也就是说 Chrome 整体架构会朝向现代操作系统所采用的“面向服务的架构” 方向发展，**原来的各种模块会被重构成独立的服务（Service）**，**每个服务（Service）都可以在独立的进程中运行**，访问服务（Service）必须使用定义好的接口，通过IPC来通信，**从而构建一个更内聚、松耦合、易于维护和扩展的系统**，更好实现 Chrome 简单、稳定、高速、安全的目标。如果你对面向服务的架构感兴趣，你可以去网上搜索下资料，这里就不过多介绍了。

Chrome最终要把UI、数据库、文件、设备、网络等模块重构为基础服务，类似操作系统底层服务，下面是Chrome“面向服务的架构”的进程模型图

![](https://mc-web-1259409954.cos.ap-guangzhou.myqcloud.com/MyImages/329658fe821252db47b0964037a1de2a.png)

目前Chrome正处在老的架构向服务化架构过渡阶段，这将是一个漫长的迭代过程。

Chrome正在逐步构建Chrome基础服务（Chrome Foundation Service），如果你认为Chrome是“便携式操作系统”，那么Chrome基础服务便可以被视为该操作系统的“基础”系统服务层。

同时Chrome还提供灵活的弹性架构，在强大性能设备上会以多进程的方式运行基础服务，但是如果在资源受限的设备上（如下图），Chrome会将很多服务整合到一个进程中，从而节省内存占用。

![](https://mc-web-1259409954.cos.ap-guangzhou.myqcloud.com/MyImages/a9ba86d7b03263fa3997d3733d958176.png)
