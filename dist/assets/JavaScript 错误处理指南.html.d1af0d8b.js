import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,e}from"./app.d7b34baa.js";const t={},p=e(`<h1 id="javascript-é”™è¯¯å¤„ç†æŒ‡å—" tabindex="-1"><a class="header-anchor" href="#javascript-é”™è¯¯å¤„ç†æŒ‡å—" aria-hidden="true">#</a> JavaScript é”™è¯¯å¤„ç†æŒ‡å—</h1><h2 id="ä»€ä¹ˆæ˜¯ç¼–ç¨‹ä¸­çš„é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ç¼–ç¨‹ä¸­çš„é”™è¯¯" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯ç¼–ç¨‹ä¸­çš„é”™è¯¯</h2><p>æˆ‘ä»¬çš„å¼€å‘è¿‡ç¨‹ä¸­å¹¶ä¸æ€»æ˜¯ä¸€å¸†é£é¡ºã€‚ç‰¹åˆ«æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åœæ­¢ç¨‹åºæˆ–åœ¨å‘ç”Ÿä¸è‰¯æƒ…å†µæ—¶é€šçŸ¥ç”¨æˆ·ã€‚</p><p>ä¾‹å¦‚ï¼š</p><ul><li>ç¨‹åºè¯•å›¾æ‰“å¼€ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ã€</li><li>ç½‘ç»œè¿æ¥æ–­å¼€</li><li>ç”¨æˆ·è¾“å…¥äº†æ— æ•ˆå­—ç¬¦</li></ul><p>åœ¨ç±»ä¼¼è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å†™ä¸ªè‡ªå®šä¹‰çš„é”™è¯¯æ¥ç®¡ç†ï¼Œæˆ–è€…ç›´æ¥è®©å¼•æ“ä¸ºæˆ‘ä»¬å»å®šä¹‰è¿™äº›é”™è¯¯ã€‚æœ‰äº†é”™è¯¯å®šä¹‰åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¶ˆæ¯é€šçŸ¥ç”¨æˆ·ï¼Œæˆ–è€…åœæ­¢æ‰§è¡Œç¨‹åºçš„è¿è¡Œã€‚</p><h2 id="javascript-ä¸­çš„é”™è¯¯æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#javascript-ä¸­çš„é”™è¯¯æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> JavaScript ä¸­çš„é”™è¯¯æ˜¯ä»€ä¹ˆ</h2><p>JavaScriptä¸­çš„é”™è¯¯æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚è¦åœ¨ JS åˆ›å»ºä¸€ä¸ªé”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>Error</code> å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>const err = new Error(&#39;éœéœï¼Œå¥½åƒå“ªé‡Œå‡ºé—®é¢˜äº†ï¼&#39;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥çœç•¥<code>new</code>å…³é”®å­—:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>const err = Error(&#39;éœéœï¼Œå¥½åƒå“ªé‡Œå‡ºé—®é¢˜äº†ï¼&#39;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åˆ›å»ºï¼Œé”™è¯¯å¯¹è±¡æœ‰ä¸‰ä¸ªå±æ€§ï¼š</p><ul><li><strong>message</strong>:å¸¦æœ‰é”™è¯¯æ¶ˆæ¯çš„å­—ç¬¦ä¸²</li><li><strong>name</strong>ï¼šé”™è¯¯çš„ç±»å‹</li><li><strong>stack</strong>ï¼šå‡½æ•°æ‰§è¡Œçš„å †æ ˆè·Ÿè¸ª</li></ul><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>TypeError</code> å¯¹è±¡åˆ›å»ºä¸€ä¸ªé”™è¯¯ï¼Œå¯¹åº”çš„ <code>message</code> æ˜¯åˆ›å»ºçš„ä¼ å…¥çš„å­—ç¬¦å·ï¼Œ<code>name</code> æ˜¯ <strong>&quot;TypeError&quot;</strong> ğŸ˜€</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>const wrongType = TypeError(&quot;éœéœï¼Œå¥½åƒå“ªé‡Œå‡ºé—®é¢˜äº†ï¼&quot;)

wrongType.message // &quot;éœéœï¼Œå¥½åƒå“ªé‡Œå‡ºé—®é¢˜äº†ï¼&quot;
wrongType.name // &quot;TypeError&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="javascriptä¸­çš„è®¸å¤šç±»å‹çš„é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#javascriptä¸­çš„è®¸å¤šç±»å‹çš„é”™è¯¯" aria-hidden="true">#</a> JavaScriptä¸­çš„è®¸å¤šç±»å‹çš„é”™è¯¯</h2><p>JavaScript ä¸­æœ‰å¾ˆå¤šç±»å‹çš„é”™è¯¯ ğŸ˜±,å¦‚ï¼š</p><ul><li>Error</li><li>EvalError</li><li>InternalError</li><li>RangeError</li><li>ReferenceError</li><li>SyntaxError</li><li>TypeError</li><li>URIError</li></ul><p>è®°ä½ï¼Œæ‰€æœ‰è¿™äº›é”™è¯¯ç±»å‹éƒ½æ˜¯å®é™…çš„æ„é€ å‡½æ•°ï¼Œæ„å‘³ç€è¿”å›ä¸€ä¸ªæ–°çš„é”™è¯¯å¯¹è±¡ã€‚</p><p>åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œä¸»è¦è¿˜æ˜¯ä½¿ç”¨<code>Error</code>å’Œ<code>TypeError</code>è¿™ä¸¤ç§æœ€å¸¸è§çš„ç±»å‹æ¥åˆ›å»ºè‡ªå·±çš„é”™è¯¯å¯¹è±¡ ğŸ˜³ã€‚</p><p>å¤§å¤šæ•°æ—¶å€™ï¼Œå¤§å¤šæ•°é”™è¯¯å°†ç›´æ¥æ¥è‡ªJavaScriptå¼•æ“ï¼Œä¾‹å¦‚<code>InternalError</code>æˆ–<code>SyntaxError</code>ã€‚</p><p>å¦‚æœä½ é‡æ–°èµ‹å€¼ç»™ <code>const</code> å£°æ˜çš„å˜é‡æ—¶ï¼Œå°±ä¼šå¼•å‘ <code>TypeError</code> é”™è¯¯ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>const name = &quot;å‰ç«¯å°æ™º&quot;
name = &quot;ç‹å¤§å†¶&quot;

// // TypeError: Assignment to constant variable.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>SyntaxError</code> é”™è¯¯ä¸€èˆ¬æ˜¯å…³é”®å­—æ‰“é”™äº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>va x = &#39;33&#39;;
// SyntaxError: Unexpected identifier
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…ï¼Œå½“åœ¨é”™è¯¯çš„åœ°æ–¹ä½¿å…³é”®å­—æ—¶ï¼Œä¾‹å¦‚<code>await</code> å’Œ <code>async</code> çš„ä½¿ç”¨ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>function wrong(){
    await 99;
}

wrong();

// SyntaxError: await is only valid in async function
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦ä¸€ä¸ª<code>TypeError</code>çš„ä¾‹å­æ˜¯ï¼Œåœ¨é¡µé¢æ“ä½œä¸å­˜åœ¨çš„ DOM å…ƒç´ ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Uncaught TypeError: button is null
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>é™¤äº†è¿™äº›å†…ç½®é”™è¯¯å¤–ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿˜æœ‰ï¼š</p><ul><li>DOMException</li><li>DOMErrorï¼Œç°åœ¨å·²ç»åºŸå¼ƒï¼Œä¸å†ä½¿ç”¨äº†ã€‚</li></ul><p><code>DOMException</code>æ˜¯ä¸ Web API ç›¸å…³çš„ä¸€ç³»åˆ—é”™è¯¯ã€‚å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œæ„šè ¢çš„æ“ä½œæ—¶ï¼Œå®ƒä»¬ä¼šè¢«æŠ›å‡ºï¼Œä¾‹å¦‚ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>document.body.appendChild(document.cloneNode(true));
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Uncaught DOMException: Node.appendChild: May not add a Document as a child
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="ä»€ä¹ˆæ˜¯å¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯å¼‚å¸¸" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯å¼‚å¸¸ï¼Ÿ</h2><p>å¤§å¤šæ•°å¼€å‘äººå‘˜è®¤ä¸ºé”™è¯¯å’Œå¼‚å¸¸æ˜¯ä¸€å›äº‹ã€‚å®é™…ä¸Šï¼Œ<strong>é”™è¯¯å¯¹è±¡åªæœ‰åœ¨æŠ›å‡ºæ—¶æ‰ä¼šå˜æˆå¼‚å¸¸ã€‚</strong></p><p>è¦åœ¨JavaScriptä¸­å¼•å‘å¼‚å¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>throw</code> å…³é”®å­—æŠŠé”™è¯¯æŠ›å‡ºå»ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>const wrongType = TypeError(&quot;éœéœï¼Œå¥½åƒå“ªé‡Œå‡ºé—®é¢˜äº†ï¼&quot;)

throw wrongType;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç®€å†™å½¢å¼ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>throw TypeError(&quot;éœéœï¼Œå¥½åƒå“ªé‡Œå‡ºé—®é¢˜äº†ï¼&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ–è€…</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>throw new TypeError(&quot;éœéœï¼Œå¥½åƒå“ªé‡Œå‡ºé—®é¢˜äº†ï¼&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœ¨å‡½æ•°ä½“æˆ–è€…æ¡ä»¶ä¹‹å¤–æŠ›å‡ºå¼‚æ­¥çš„å¯èƒ½æ€§ä¸å¤§ï¼Œè€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>function toUppercase(string) {
  if (typeof string !== &quot;string&quot;) {
    throw TypeError(&quot;éœéœï¼Œå¥½åƒå“ªé‡Œå‡ºé—®é¢˜äº†ï¼&quot;);
  }

  return string.toUpperCase();
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬æ£€æŸ¥å‡½æ•°å‚æ•°æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ã€‚å¦‚æœä¸æ˜¯ï¼Œæˆ‘ä»¬æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼ŒJavaScriptä¸­å¯ä»¥æŠ›å‡ºä»»ä½•ä¸œè¥¿ï¼Œè€Œä¸ä»…ä»…æ˜¯é”™è¯¯å¯¹è±¡</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>throw Symbol();
throw 33;
throw &quot;Error!&quot;;
throw null;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œæœ€å¥½é¿å…è¿™äº›äº‹æƒ…ï¼šå§‹ç»ˆæŠ›å‡ºæ­£ç¡®çš„é”™è¯¯å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€äº›åŸºæœ¬ç±»å‹ã€‚</p><p>è¿™æ ·æœ‰åŠ©äºåœ¨ä»£ç ä¸­ï¼Œé”™è¯¯å¤„ç†çš„ä¸€è‡´æ€§ã€‚å…¶ä»–æˆå‘˜å¯ä»¥æœŸæœ›åœ¨é”™è¯¯å¯¹è±¡ä¸Šè®¿é—®<code>error.message</code>æˆ–<code>error.stack</code> æ¥çŸ¥é“é”™è¯¯çš„æºå¤´ã€‚</p><h2 id="å½“æˆ‘ä»¬æŠ›å‡ºå¼‚å¸¸æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#å½“æˆ‘ä»¬æŠ›å‡ºå¼‚å¸¸æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ" aria-hidden="true">#</a> å½“æˆ‘ä»¬æŠ›å‡ºå¼‚å¸¸æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h2><p>å¼‚å¸¸å°±åƒä¸€ä¸ªä¸Šå‡çš„ç”µæ¢¯:ä¸€æ—¦ä½ æŠ›å‡ºä¸€ä¸ªï¼Œå®ƒå°±ä¼šåœ¨ç¨‹åºå †æ ˆä¸­å†’æ³¡ï¼Œé™¤éå®ƒåœ¨æŸä¸ªåœ°æ–¹è¢«æ•è·ã€‚</p><p>è€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>function toUppercase(string) {
  if (typeof string !== &quot;string&quot;) {
    throw TypeError(&quot;å‚æ•°ç±»å‹éœ€è¦æ˜¯ string çš„&quot;);
  }

  return string.toUpperCase();
}

toUppercase(4);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œä»£ç ä¼šåœ¨æ§åˆ¶å°çœ‹åˆ°ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Uncaught TypeError: Wrong type given, expected a string
    toUppercase http://localhost:5000/index.js:3
    &lt;anonymous&gt; http://localhost:5000/index.js:9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°å‘ç”Ÿé”™è¯¯çš„ç¡®åˆ‡è¡Œã€‚</p><p>è¿™ä¸ªæŠ¥å‘Šæ˜¯ä¸€ä¸ªå †æ ˆè·Ÿè¸ªï¼Œå®ƒæœ‰åŠ©äºè·Ÿè¸ªä»£ç ä¸­çš„é—®é¢˜ã€‚å †æ ˆè·Ÿè¸ªä»ä¸‹è‡³ä¸Š:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code> toUppercase http://localhost:5000/index.js:3
    &lt;anonymous&gt; http://localhost:5000/index.js:9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é™¤äº†åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­çœ‹åˆ°æ­¤å †æ ˆè·Ÿè¸ªå¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡é”™è¯¯å¯¹è±¡çš„<code>stack</code>å±æ€§è¿›è¡ŒæŸ¥çœ‹ã€‚</p><p>å¦‚æœå¼‚å¸¸æœªè¢«æ•è·ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºå‘˜ä¸é‡‡å–ä»»ä½•æªæ–½æ¥æ•è·å®ƒï¼Œç¨‹åºå°†å´©æºƒã€‚</p><p><strong>ä½•æ—¶ä½•åœ°æ•è·ä»£ç ä¸­çš„å¼‚å¸¸å–å†³äºç‰¹å®šçš„ç”¨ä¾‹ã€‚</strong></p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³åœ¨å †æ ˆä¸­ä¼ é€’ä¸€ä¸ªå¼‚å¸¸ï¼Œä»¥ä½¿ç¨‹åºå®Œå…¨å´©æºƒã€‚è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨ï¼Œ è®©é”™è¯¯åœæ­¢ç¨‹åºæ¯”å¤„ç†æ— æ•ˆæ•°æ®æ¥å¾—æ›´å®‰å…¨ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ JavaScript åŒæ­¥å’Œå¼‚æ­¥ä¸­çš„é”™è¯¯å’Œå¼‚å¸¸å¤„ç†ã€‚</p><h2 id="åŒæ­¥ä¸­çš„é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#åŒæ­¥ä¸­çš„é”™è¯¯å¤„ç†" aria-hidden="true">#</a> åŒæ­¥ä¸­çš„é”™è¯¯å¤„ç†</h2><p>åŒæ­¥ä»£ç åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½å¾ˆç®€å•ï¼Œå› æ­¤å®ƒçš„é”™è¯¯å¤„ç†ä¹Ÿå¾ˆç®€å•ã€‚</p><h4 id="å¸¸è§„å‡½æ•°çš„é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#å¸¸è§„å‡½æ•°çš„é”™è¯¯å¤„ç†" aria-hidden="true">#</a> å¸¸è§„å‡½æ•°çš„é”™è¯¯å¤„ç†</h4><p>åŒæ­¥ä»£ç çš„æ‰§è¡Œé¡ºåºä¸å†™å…¥é¡ºåºç›¸åŒã€‚æˆ‘ä»¬å†çœ‹ä¸€ä¸‹å‰é¢çš„ä¾‹å­:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">toUppercase</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> string <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;å‚æ•°ç±»å‹éœ€è¦æ˜¯ string çš„&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">toUppercase</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œå¼•æ“è°ƒç”¨å¹¶æ‰§è¡Œ<code>toUppercase</code>ã€‚æ‰€æœ‰è¿™äº›éƒ½æ˜¯åŒæ­¥å‘ç”Ÿçš„ã€‚è¦æ•è·åŒæ­¥å‡½æ•°å¼•å‘çš„å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>try/catch/finally</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">toUppercase</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>try/catch/finally</code>æ˜¯ä¸€ä¸ªåŒæ­¥ç»“æ„ï¼Œä½†å®ƒä¹Ÿå¯ä»¥æ•è·å¼‚æ­¥å‡ºç°çš„å¼‚å¸¸ã€‚</p><h2 id="ä½¿ç”¨-generator-å‡½æ•°æ¥å¤„ç†é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-generator-å‡½æ•°æ¥å¤„ç†é”™è¯¯" aria-hidden="true">#</a> ä½¿ç”¨ generator å‡½æ•°æ¥å¤„ç†é”™è¯¯</h2><p>JavaScriptä¸­çš„<code>ç”Ÿæˆå™¨å‡½æ•°</code>æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ã€‚é™¤äº†åœ¨å…¶å†…éƒ¨ä½œç”¨åŸŸå’Œä½¿ç”¨è€…ä¹‹é—´æä¾›åŒå‘é€šä¿¡é€šé“ä¹‹å¤–ï¼Œè¿˜å¯ä»¥éšæ„<strong>æš‚åœ</strong>å’Œ<strong>æ¢å¤</strong>ã€‚</p><p>è¦åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨<code>function</code>å…³é”®å­—åé¢æ”¾ä¸€ä¸ª<code>*</code>:</p><p>JavaScriptä¸­çš„<code>ç”Ÿæˆå™¨å‡½æ•°</code>æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ã€‚é™¤äº†åœ¨å…¶å†…éƒ¨ä½œç”¨åŸŸå’Œä½¿ç”¨è€…ä¹‹é—´æä¾›åŒå‘é€šä¿¡é€šé“ä¹‹å¤–ï¼Œè¿˜å¯ä»¥éšæ„<strong>æš‚åœ</strong>å’Œ<strong>æ¢å¤</strong>ã€‚</p><p>è¦åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨<code>function</code>å…³é”®å­—åé¢æ”¾ä¸€ä¸ª<code>*</code>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å‡½æ•°å†…å¯ä»¥ä½¿ç”¨<code>yield</code>è¿”å›å€¼ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">33</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">99</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”Ÿæˆå™¨å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª<strong>è¿­ä»£å™¨å¯¹è±¡</strong>(iterator object)ã€‚è¦ä»ç”Ÿæˆå™¨ä¸­æå–å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•:</p><ul><li>ä½¿ç”¨ <code>next()</code> æ–¹æ³•</li><li>é€šè¿‡ <code>for...of</code> éå†</li></ul><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œè¦æƒ³åœ¨ç”Ÿæˆå™¨ä¸­è·å–å€¼ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">33</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">99</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> go <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> firstStep <span class="token operator">=</span> go<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 33</span>
<span class="token keyword">const</span> secondStep <span class="token operator">=</span> go<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 99</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆå™¨ä¹Ÿå¯ä»¥é‡‡ç”¨å…¶ä»–æ–¹æ³•å·¥ä½œï¼šå®ƒä»¬å¯ä»¥æ¥æ”¶è°ƒç”¨è€…è¿”å›çš„å€¼å’Œå¼‚å¸¸ã€‚</p><p>é™¤äº†<code>next()</code>ä¹‹å¤–ï¼Œ<strong>ä»ç”Ÿæˆå™¨è¿”å›çš„è¿­ä»£å™¨å¯¹è±¡è¿˜å…·æœ‰<code>throw()</code>æ–¹æ³•ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘ç”Ÿæˆå™¨ä¸­æ³¨å…¥ä¸€ä¸ªå¼‚å¸¸æ¥åœæ­¢ç¨‹åº</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">33</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">99</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> go <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> firstStep <span class="token operator">=</span> go<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 33</span>

go<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;æˆ‘è¦ç»“æŸä½ !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> secondStep <span class="token operator">=</span> go<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œä¼šæŠ›å‡ºå¼‚å¸¸</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¦è·å–æ­¤é”™è¯¯ï¼Œå¯ä»¥åœ¨ç”Ÿæˆå™¨å‡½æ•°ä¸­ä½¿ç”¨ <code>try/catch/finally</code>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token number">33</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token number">99</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢è¿™ä¸ªäº‹ä¾‹æ˜¯ä½¿ç”¨ <code>for...of</code> æ¥è·å– ç”Ÿæˆå™¨å‡½æ•°ä¸­çš„å€¼:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">33</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">99</span><span class="token punctuation">;</span>
  
  <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;æˆ‘è¦ç»“æŸä½ !&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> value <span class="token keyword">of</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/* è¾“å‡ºï¼š
  33
  99
  æˆ‘è¦ç»“æŸä½ !
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å¼‚æ­¥ä¸­çš„é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥ä¸­çš„é”™è¯¯å¤„ç†" aria-hidden="true">#</a> å¼‚æ­¥ä¸­çš„é”™è¯¯å¤„ç†</h2><p><strong>JavaScriptæœ¬è´¨ä¸Šæ˜¯åŒæ­¥çš„ï¼Œæ˜¯ä¸€ç§å•çº¿ç¨‹è¯­è¨€ã€‚</strong></p><p>è¯¸å¦‚æµè§ˆå™¨å¼•æ“ä¹‹ç±»çš„å®¿ä¸»ç¯å¢ƒä½¿ç”¨è®¸å¤šWeb APIï¼Œ å¢å¼ºäº† JS ä»¥ä¸å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œäº¤äº’å¹¶å¤„ç†ä¸ I/O ç»‘å®šçš„æ“ä½œã€‚</p><p>æµè§ˆå™¨ä¸­å¼‚æ­¥æ“ä½œæœ‰ï¼šå®šæ—¶å™¨ç›¸å…³çš„å‡½æ•°ã€äº‹ä»¶å’Œ Promiseã€‚</p><p>å¼‚æ­¥ä¸­çš„é”™è¯¯å¤„ç†ä¸åŒäºåŒæ­¥çš„é”™è¯¯å¤„ç†ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€äº›ä¾‹å­ã€‚</p><h4 id="å®šæ—¶å™¨çš„é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#å®šæ—¶å™¨çš„é”™è¯¯å¤„ç†" aria-hidden="true">#</a> å®šæ—¶å™¨çš„é”™è¯¯å¤„ç†</h4><p>è€ƒè™‘ä¸‹é¢çš„ä»£ç ç‰‡æ®µ:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>function failAfterOneSecond() {
  setTimeout(() =&gt; {
    throw Error(&quot;Something went wrong!&quot;);
  }, 1000);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå‡½æ•°å¤§çº¦åœ¨1ç§’åæŠ›å‡ºå¼‚å¸¸ï¼Œå¤„ç†è¿™ä¸ªå¼‚å¸¸çš„æ­£ç¡®æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ä¸‹é¢çš„æ–¹æ³•ä¸èµ·ä½œç”¨ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>function failAfterOneSecond() {
  setTimeout(() =&gt; {
    throw Error(&quot;Something went wrong!&quot;);
  }, 1000);
}

try {
  failAfterOneSecond();
} catch (error) {
  console.error(error.message);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬çŸ¥é“ <code>try/catch</code> æ˜¯åŒæ­¥ï¼Œè€Œ <code>setTimeout</code> æ˜¯å¼‚æ­¥çš„ã€‚å½“æ‰§è¡Œåˆ° <code>setTimeout</code>å›è°ƒæ—¶ï¼Œ<code>try/catch</code> æ—©å·²è·‘å®Œäº†ï¼Œæ‰€ä»¥å¼‚å¸¸å°±æ— æ³•æ•è·åˆ°ã€‚</p><p>å®ƒä»¬åœ¨ä¸¤åŠ¡ä¸åŒçš„è½¨é“ä¸Šï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Track A: --&gt; try/catch
Track B: --&gt; setTimeout --&gt; callback --&gt; throw
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœèƒ½è®©ç¨‹åºè·‘ä¸‹å»ï¼ŒæŠŠ <code>try/catch</code> ç§»åŠ¨åˆ° <code>setTimeout</code> é‡Œé¢ã€‚ä½†è¿™ç§åšæ³•æ„ä¹‰ä¸å¤§ï¼Œåé¢æˆ‘ä»¬ä¼šä½¿ç”¨ Promise æ¥è§£å†³è¿™ç±»çš„é—®é¢˜ã€‚</p><h4 id="äº‹ä»¶ä¸­é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶ä¸­é”™è¯¯å¤„ç†" aria-hidden="true">#</a> äº‹ä»¶ä¸­é”™è¯¯å¤„ç†</h4><p>DOM çš„äº‹ä»¶æ“ä½œï¼ˆç›‘å¬å’Œè§¦å‘ï¼‰ï¼Œéƒ½å®šä¹‰åœ¨<code>EventTarget</code>æ¥å£ã€‚<code>Element</code>èŠ‚ç‚¹ã€<code>document</code>èŠ‚ç‚¹å’Œ<code>window</code>å¯¹è±¡ï¼Œéƒ½éƒ¨ç½²äº†è¿™ä¸ªæ¥å£ã€‚æ­¤å¤–ï¼ŒXMLHttpRequestã€<code>AudioNode</code>ã€<code>AudioContext</code>ç­‰æµè§ˆå™¨å†…ç½®å¯¹è±¡ï¼Œä¹Ÿéƒ¨ç½²äº†è¿™ä¸ªæ¥å£ã€‚è¯¥æ¥å£å°±æ˜¯ä¸‰ä¸ªæ–¹æ³•ï¼Œ<code>addEventListener</code>å’Œ<code>removeEventListener</code>ç”¨äºç»‘å®šå’Œç§»é™¤ç›‘å¬å‡½æ•°ï¼Œ<code>dispatchEvent</code>ç”¨äºè§¦å‘äº‹ä»¶ã€‚</p><p>DOM äº‹ä»¶çš„é”™è¯¯å¤„ç†æœºåˆ¶éµå¾ªä»»ä½•å¼‚æ­¥Web APIçš„ç›¸åŒæ–¹æ¡ˆã€‚</p><p>è€ƒè™‘ä¸‹é¢ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>const button = document.querySelector(&quot;button&quot;);

button.addEventListener(&quot;click&quot;, function() {
  throw Error(&quot;Can&#39;t touch this button!&quot;);
});
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œå•å‡»æŒ‰é’®åç«‹å³å¼•å‘å¼‚å¸¸ã€‚æˆ‘ä»¬å¦‚ä½•æŠ“ä½å®ƒï¼Ÿä¸‹é¢è¿™ç§æ–¹å¼æ²¡å•¥ä½œç”¨ï¼Œä¹Ÿä¸ä¼šé˜»æ­¢ç¨‹åºå´©æºƒï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>const button = document.querySelector(&quot;button&quot;);

try {
  button.addEventListener(&quot;click&quot;, function() {
    throw Error(&quot;Can&#39;t touch this button!&quot;);
  });
} catch (error) {
  console.error(error.message);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ <code>setTimeout</code> ä¸€æ ·ï¼Œ<code>addEventListener</code> ä¹Ÿæ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Track A: --&gt; try/catch
Track B: --&gt; addEventListener --&gt; callback --&gt; throw
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœèƒ½è®©ç¨‹åºè·‘ä¸‹å»ï¼ŒæŠŠ <code>try/catch</code> ç§»åŠ¨åˆ° <code>addEventListener</code> é‡Œé¢ã€‚ä½†è¿™ç§åšæ³•æ„ä¹‰ä¸å¤§ï¼Œåé¢æˆ‘ä»¬ä¼šä½¿ç”¨ Promise æ¥è§£å†³è¿™ç±»çš„é—®é¢˜ã€‚</p><h2 id="onerror-æ€ä¹ˆæ ·" tabindex="-1"><a class="header-anchor" href="#onerror-æ€ä¹ˆæ ·" aria-hidden="true">#</a> onerror æ€ä¹ˆæ ·</h2><p>HTMLå…ƒç´ å…·æœ‰è®¸å¤šäº‹ä»¶å¤„ç†ç¨‹åºï¼Œä¾‹å¦‚<code>onclick</code>ï¼Œ<code>onmouseenter</code>ï¼Œ<code>onchange</code>ç­‰ï¼Œå½“ç„¶è¿˜æœ‰ <code>onerror</code>ã€‚</p><p>å½“ <code>img</code> æ ‡ç­¾æˆ– <code>script</code> æ ‡ç­¾é‡åˆ°ä¸å­˜åœ¨çš„èµ„æºæ—¶ï¼Œ<code>onerror</code>äº‹ä»¶å¤„ç†ç¨‹åºéƒ½ä¼šè§¦å‘ã€‚</p><p>è€ƒè™‘ä¸‹é¢ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>...
&lt;body&gt;
  &lt;img src=&quot;nowhere-to-be-found.png&quot; alt=&quot;So empty!&quot;&gt;
&lt;/body&gt;
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œæ§åˆ¶å°å°±ä¼šæŠ¥å¦‚ä¸‹çš„é”™è¯¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET http://localhost:5000/nowhere-to-be-found.png
[HTTP/1.1 404 Not Found 3ms]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ JS ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>onerror</code> æ¥æ•è·è¿™ä¸ªé”™è¯¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>const image = document.querySelector(&quot;img&quot;);

image.onerror = function(event) {
  console.log(event);
};
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ›´å¥½çš„æ–¹å¼ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>const image = document.querySelector(&quot;img&quot;);

image.addEventListener(&quot;error&quot;, function(event) {
  console.log(event);
});
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹å¼å¯¹äºä¸€äº›è¯·æ±‚èµ„æºä¸¢å¤±çš„æƒ…å†µå¾ˆæœ‰ç”¨ï¼Œä½† <code>onerror</code> ä¸ <code>throw</code> ä¸ <code>try/cathc</code> æ— å…³ã€‚</p><h2 id="ä½¿ç”¨-promise-å¤„ç†é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-promise-å¤„ç†é”™è¯¯" aria-hidden="true">#</a> ä½¿ç”¨ Promise å¤„ç†é”™è¯¯</h2><p>ä¸ºäº†æ¼”ç¤º <code>Promise</code> å¤„ç†æ–¹å¼ï¼Œæˆ‘ä»¬å…ˆå›åˆ°ä¸€å¼€å§‹çš„é‚£ä¸ªäº‹ä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>function toUppercase(string) {
  if (typeof string !== &quot;string&quot;) {
    throw TypeError(&quot;Wrong type given, expected a string&quot;);
  }

  return string.toUpperCase();
}

toUppercase(4);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›¸å¯¹ç®€å•æŠ›å‡ºå¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Promise.reject</code> å’Œ<code>Promise.resolve</code>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>function toUppercase(string) {
  if (typeof string !== &quot;string&quot;) {
    return Promise.reject(TypeError(&quot;Wrong type given, expected a string&quot;));
  }

  const result = string.toUpperCase();

  return Promise.resolve(result);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºä½¿ç”¨äº† <strong>Promise</strong> ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ <code>then</code> æ¥æ¥æ”¶è¿”å›çš„å†…å®¹ï¼Œæˆ–è€…ç”¨ <code>catch</code> æ¥æ•è·å‡ºç°çš„é”™è¯¯ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>toUppercase(99)
  .then(result =&gt; result)
  .catch(error =&gt; console.error(error.message));
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„æ‰§è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Wrong type given, expected a string
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>é™¤äº† <code>then</code> å’Œ <code>catch</code> , Promise ä¸­è¿˜æœ‰ <code>finally</code> æ–¹æ³•ï¼Œè¿™ç±»ä¼¼äº<code>try/catch</code> ä¸­çš„ <code>finally</code>ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>toUppercase(99)
  .then(result =&gt; result)
  .catch(error =&gt; console.error(error.message))
  .finally(() =&gt; console.log(&quot;Run baby, run&quot;));
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="promise-error-å’Œ-throw" tabindex="-1"><a class="header-anchor" href="#promise-error-å’Œ-throw" aria-hidden="true">#</a> Promise, error, å’Œ throw</h2><p>ä½¿ç”¨ Promise.reject å¯ä»¥å¾ˆæ–¹ä¾¿çš„æŠ›å‡ºé”™è¯¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Promise.reject(TypeError(&quot;Wrong type given, expected a string&quot;));
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>é™¤äº†<code>Promise.reject</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥é€€å‡º Promiseã€‚</p><p>è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;A string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Expected a number!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¦åœæ­¢å¼‚å¸¸ä¼ æ’­ï¼Œæˆ‘ä»¬ç…§å¸¸ä½¿ç”¨<code>catch</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;A string&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token function">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Expected a number!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ¨¡å¼åœ¨<code>fetch</code>ä¸­å¾ˆå¸¸è§:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;https://example-dev/api/&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨<code>catch</code>æ‹¦æˆªå¼‚å¸¸ã€‚å¦‚æœæˆ‘ä»¬å¤±è´¥äº†ï¼Œæˆ–è€…å†³å®šä¸æ•è·å®ƒï¼Œå¼‚å¸¸å¯ä»¥åœ¨å †æ ˆä¸­è‡ªç”±å†’æ³¡ã€‚</p><h2 id="ä½¿ç”¨-promise-æ¥å¤„ç†å®šæ—¶å™¨ä¸­çš„å¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-promise-æ¥å¤„ç†å®šæ—¶å™¨ä¸­çš„å¼‚å¸¸" aria-hidden="true">#</a> ä½¿ç”¨ Promise æ¥å¤„ç†å®šæ—¶å™¨ä¸­çš„å¼‚å¸¸</h2><p>ä½¿ç”¨å®šæ—¶å™¨æˆ–äº‹ä»¶æ— æ³•æ•è·ä»å›è°ƒå¼•å‘çš„å¼‚å¸¸ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">failAfterOneSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Something went wrong!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// DOES NOT WORK</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">failAfterOneSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ Promise:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">failAfterOneSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Something went wrong!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨<code>reject</code>ï¼Œæˆ‘ä»¬å¯åŠ¨äº†ä¸€ä¸ª Promise æ‹’ç»ï¼Œå®ƒæºå¸¦ä¸€ä¸ªé”™è¯¯å¯¹è±¡ã€‚</p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>catch</code>å¤„ç†å¼‚å¸¸:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">failAfterOneSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="ä½¿ç”¨-promise-all-æ¥å¤„ç†é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-promise-all-æ¥å¤„ç†é”™è¯¯" aria-hidden="true">#</a> ä½¿ç”¨ Promise.all æ¥å¤„ç†é”™è¯¯</h2><p><code>Promise.all(iterable)</code> æ–¹æ³•è¿”å›ä¸€ä¸ª Promise å®ä¾‹ï¼Œæ­¤å®ä¾‹åœ¨ iterable å‚æ•°å†…æ‰€æœ‰çš„ promise éƒ½â€œå®Œæˆï¼ˆresolvedï¼‰â€æˆ–å‚æ•°ä¸­ä¸åŒ…å« promise æ—¶å›è°ƒå®Œæˆï¼ˆresolveï¼‰ï¼›</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> promise1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;All good!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;All good here too!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">results</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// [ &#39;All good!&#39;, &#39;All good here too!&#39; ]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å¦‚æœå‚æ•°ä¸­ promise æœ‰ä¸€ä¸ªå¤±è´¥ï¼ˆrejectedï¼‰ï¼Œæ­¤å®ä¾‹å›è°ƒå¤±è´¥ï¼ˆrejectï¼‰ï¼Œå¤±è´¥çš„åŸå› æ˜¯ç¬¬ä¸€ä¸ªå¤±è´¥ promise çš„ç»“æœã€‚</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> promise1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;All good!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;No good, sorry!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Bad day ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">,</span> promise3<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// No good, sorry!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒæ ·ï¼Œæ— è®º<code>Promise.all</code>çš„ç»“æœå¦‚ä½•è¿è¡Œå‡½æ•°ï¼Œ<code>finally</code> éƒ½ä¼šè¢«æ‰§è¡Œï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">,</span> promise3<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Always runs!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä½¿ç”¨-promise-any-æ¥å¤„ç†é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-promise-any-æ¥å¤„ç†é”™è¯¯" aria-hidden="true">#</a> ä½¿ç”¨ Promise.any æ¥å¤„ç†é”™è¯¯</h2><p><code>Promise.any()</code> (Firefox &gt; 79, Chrome &gt; 85) æ¥æ”¶ä¸€ä¸ª Promise å¯è¿­ä»£å¯¹è±¡ï¼Œåªè¦å…¶ä¸­çš„ä¸€ä¸ª promise æˆåŠŸï¼Œå°±è¿”å›é‚£ä¸ªå·²ç»æˆåŠŸçš„ promise ã€‚<strong>å¦‚æœå¯è¿­ä»£å¯¹è±¡ä¸­æ²¡æœ‰ä¸€ä¸ª promise æˆåŠŸï¼ˆå³æ‰€æœ‰çš„ promises éƒ½å¤±è´¥/æ‹’ç»ï¼‰ï¼Œå°±è¿”å›ä¸€ä¸ªå¤±è´¥çš„ <code>promise</code> å’Œ<code>AggregateError</code>ç±»å‹çš„å®ä¾‹ï¼Œå®ƒæ˜¯ <code>Error</code> çš„ä¸€ä¸ªå­ç±»ï¼Œç”¨äºæŠŠå•ä¸€çš„é”™è¯¯é›†åˆåœ¨ä¸€èµ·ã€‚æœ¬è´¨ä¸Šï¼Œè¿™ä¸ªæ–¹æ³•å’Œ<code>Promise.all()</code>æ˜¯ç›¸åçš„ã€‚</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> promise1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;No good, sorry!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Bad day ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Always runs!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨<code>catch</code>å¤„ç†é”™è¯¯ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">AggregateError</span><span class="token operator">:</span> No Promise <span class="token keyword">in</span> Promise<span class="token punctuation">.</span>any was resolved
Always runs<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>AggregateError</code>å¯¹è±¡å…·æœ‰ä¸åŸºæœ¬<code>Error</code>ç›¸åŒçš„å±æ€§ï¼Œå¤–åŠ <code>errors</code>å±æ€§ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>errors<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å±æ€§æ˜¯ç”±<code>reject</code>äº§ç”Ÿçš„æ¯ä¸ªå•ç‹¬é”™è¯¯çš„æ•°ç»„</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span>Error<span class="token operator">:</span> <span class="token string">&quot;No good, sorry!, Error: &quot;</span>Bad day <span class="token operator">...</span>&quot;<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="ä½¿ç”¨-promise-race-æ¥å¤„ç†é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-promise-race-æ¥å¤„ç†é”™è¯¯" aria-hidden="true">#</a> ä½¿ç”¨ Promise.race æ¥å¤„ç†é”™è¯¯</h2><p><code>Promise.race(iterable)</code> æ–¹æ³•è¿”å›ä¸€ä¸ª promiseï¼Œä¸€æ—¦è¿­ä»£å™¨ä¸­çš„æŸä¸ªpromiseè§£å†³æˆ–æ‹’ç»ï¼Œè¿”å›çš„ promiseå°±ä¼šè§£å†³æˆ–æ‹’ç»ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> promise1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;The first!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;The second!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The first!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œè¯´æ˜ï¼Œç¬¬ä¸€ä¸ª Promise æ¯”ç¬¬äºŒä¸ªè¡Œæ‰§è¡Œå®Œã€‚é‚£åŒ…å«æ‹’ç»çš„æƒ…å†µåˆæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> promise1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;The first!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> rejection <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Ouch!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;The second!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> rejection<span class="token punctuation">,</span> promise2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The first!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæŠŠ<code>reject</code>æ”¾åœ¨ç¬¬ä¸€ä¸ªåˆä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> promise1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;The first!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> rejection <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Ouch!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;The second!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>rejection<span class="token punctuation">,</span> promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Ouch!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä½¿ç”¨-promise-allsettled-æ¥å¤„ç†é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-promise-allsettled-æ¥å¤„ç†é”™è¯¯" aria-hidden="true">#</a> ä½¿ç”¨ Promise.allSettled æ¥å¤„ç†é”™è¯¯</h2><p><code>Promise.allSettled()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªåœ¨æ‰€æœ‰ç»™å®šçš„promiseéƒ½å·²ç»<code>fulfilled</code>æˆ–<code>rejected</code>åçš„promiseï¼Œå¹¶å¸¦æœ‰ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡è¡¨ç¤ºå¯¹åº”çš„promiseç»“æœã€‚</p><p>è€ƒè™‘ä¸‹é¢ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> promise1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;Good!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;No good, sorry!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Always runs!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ä¼ é€’ç»™<code>Promise.allSettled</code>ä¸€ä¸ªç”±ä¸¤ä¸ªPromiseç»„æˆçš„æ•°ç»„ï¼šä¸€ä¸ªå·²è§£å†³ï¼Œå¦ä¸€ä¸ªè¢«æ‹’ç»ã€‚</p><p>è¿™ç§æƒ…å†µ <code>catch</code> ä¸ä¼šè¢«æ‰§è¡Œï¼Œ <code>finally</code> æ°¸è¿œä¼šæ‰§è¡Œã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;fulfilled&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;Good!&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&#39;rejected&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">reason</span><span class="token operator">:</span> Error<span class="token operator">:</span> No good<span class="token punctuation">,</span> sorry<span class="token operator">!</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä½¿ç”¨-async-await-æ¥å¤„ç†é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-async-await-æ¥å¤„ç†é”™è¯¯" aria-hidden="true">#</a> ä½¿ç”¨ async/await æ¥å¤„ç†é”™è¯¯</h2><p>ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä½¿ç”¨å‰é¢çš„åŒæ­¥å‡½æ•°<code>toUppercase</code>ï¼Œå¹¶é€šè¿‡åœ¨<code>function</code>å…³é”®å­—å‰æ”¾ç½®<code>async</code>æ¥å°†å…¶è½¬æ¢ä¸ºå¼‚æ­¥å‡½æ•°</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">toUppercase</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> string <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Wrong type given, expected a string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åªè¦åœ¨å‡½æ•°å‰é¢åŠ ä¸Š<code>async</code>ï¼Œè¯¥å‡½æ•°å°±ä¼šè¿”å›ä¸€ä¸ª<code>Promise</code>ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°è°ƒç”¨ä¹‹åè¿›è¡Œ<code>then</code>ã€<code>catch</code>å’Œ<code>finally</code> æ“ä½œ</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">toUppercase</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> string <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Wrong type given, expected a string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">toUppercase</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Always runs!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä» <code>async</code> å‡½æ•°æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>catch</code> æ¥æ•è·ã€‚</p><p>æœ€é‡è¦çš„æ˜¯ï¼Œé™¤äº†è¿™ç§æ–¹å¼å¤–ï¼Œæˆ‘ä»¬å¯ä»¥è¿˜ä½¿ç”¨<code>try/catch/finally</code>ï¼Œå°±åƒæˆ‘ä»¬ä½¿ç”¨åŒæ­¥å‡½æ•°æ‰€åšçš„ä¸€æ ·ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">toUppercase</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> string <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Wrong type given, expected a string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">toUppercase</span><span class="token punctuation">(</span><span class="token number">98</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Always runs!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Wrong type given, expected a string
Always runs!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä½¿ç”¨-async-generators-æ¥å¤„ç†é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-async-generators-æ¥å¤„ç†é”™è¯¯" aria-hidden="true">#</a> ä½¿ç”¨ async generators æ¥å¤„ç†é”™è¯¯</h2><p>JavaScriptä¸­çš„<code>async generators</code>æ˜¯èƒ½å¤Ÿç”Ÿæˆ Promises è€Œä¸æ˜¯ç®€å•å€¼çš„ç”Ÿæˆå™¨å‡½æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">asyncGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">33</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">99</span><span class="token punctuation">;</span>
  <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Something went wrong!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise.reject</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŸºäº Promiseï¼Œæ­¤å¤„é€‚ç”¨äºé”™è¯¯å¤„ç†çš„ç›¸åŒè§„åˆ™ã€‚åœ¨å¼‚æ­¥ç”Ÿæˆå™¨ä¸­ <code>throw</code> å°†ä¼šè§¦å‘ Promise çš„<code>reject</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>catch</code>å¯¹å…¶è¿›è¡Œæ‹¦æˆªã€‚</p><p>ä¸ºäº†ä½¿ç”¨å¼‚æ­¥ç”Ÿæˆå™¨çš„ Promiseï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><ul><li>then æ–¹æ³•</li><li>å¼‚æ­¥éå†</li></ul><p>ä»ä¸Šé¢æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä¸¤æ¬¡è°ƒç”¨ <code>yield</code>ä¹‹åï¼Œä¸‹ä¸€æ¬¡ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> go <span class="token operator">=</span> <span class="token function">asyncGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

go<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
go<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
go<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
Something went wrong<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ«ä¸€ç§æ˜¯ä½¿ç”¨ <code>å¼‚æ­¥éå†</code>ä¸<code>for await...of</code>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">asyncGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">33</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">99</span><span class="token punctuation">;</span>
  <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Something went wrong!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise.reject</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> value <span class="token keyword">of</span> <span class="token function">asyncGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ‰äº† <code>async/await</code> æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>try/catch</code> æ¥æ•è·å¼‚å¸¸ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">asyncGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">33</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">99</span><span class="token punctuation">;</span>
  <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Something went wrong!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise.reject</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> value <span class="token keyword">of</span> <span class="token function">asyncGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">33</span>
<span class="token number">99</span>
Something went wrong<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°è¿”å›çš„è¿­ä»£å™¨å¯¹è±¡ä¹Ÿå…·æœ‰<code>throw()</code>æ–¹æ³•ï¼Œéå¸¸ç±»ä¼¼äºå…¶åŒæ­¥å‰¯æœ¬ã€‚åœ¨æ­¤å¤„çš„è¿­ä»£å™¨å¯¹è±¡ä¸Šè°ƒç”¨<code>throw()</code>ä¸ä¼šå¼•å‘å¼‚å¸¸ï¼Œä½†æ˜¯ä¼šè¢«Promiseæ‹’ç»</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">asyncGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">33</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">99</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">11</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> go <span class="token operator">=</span> <span class="token function">asyncGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

go<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
go<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

go<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Let&#39;s reject!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

go<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// value is undefined</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¦ä»å¤–éƒ¨å¤„ç†è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥åšï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>go<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Let&#39;s reject!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="node-ä¸­çš„é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#node-ä¸­çš„é”™è¯¯å¤„ç†" aria-hidden="true">#</a> Node ä¸­çš„é”™è¯¯å¤„ç†</h2><h4 id="node-ä¸­çš„åŒæ­¥é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#node-ä¸­çš„åŒæ­¥é”™è¯¯å¤„ç†" aria-hidden="true">#</a> Node ä¸­çš„åŒæ­¥é”™è¯¯å¤„ç†</h4><p>Node.js ä¸­çš„åŒæ­¥é”™è¯¯å¤„ç†ä¸åˆ°ç›®å‰ä¸ºæ­¢æ‰€çœ‹åˆ°çš„å¹¶æ²¡æœ‰å¤ªå¤§å·®å¼‚ã€‚å¯¹äºåŒæ­¥ï¼Œä½¿ç”¨ <code>try/catch/finally</code> å°±å¯ä»¥å¾ˆå¥½çš„å·¥ä½œäº†ã€‚</p><h4 id="node-js-ä¸­çš„å¼‚æ­¥é”™è¯¯å¤„ç†-å›è°ƒæ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„å¼‚æ­¥é”™è¯¯å¤„ç†-å›è°ƒæ¨¡å¼" aria-hidden="true">#</a> Node.js ä¸­çš„å¼‚æ­¥é”™è¯¯å¤„ç†ï¼šå›è°ƒæ¨¡å¼</h4><p>å¯¹äºå¼‚æ­¥ä»£ç ï¼ŒNode.js ä¸»è¦ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>å›è°ƒæ¨¡å¼</li><li>event emitters</li></ul><p>åœ¨å›è°ƒæ¨¡å¼ä¸­ï¼Œå¼‚æ­¥ Node.js API æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°é€šè¿‡äº‹ä»¶å¾ªç¯å¤„ç†ï¼Œå¹¶åœ¨è°ƒç”¨å †æ ˆä¸ºç©ºæ—¶ç«‹å³æ‰§è¡Œã€‚</p><p>è€ƒè™‘ä»¥ä¸‹ä»£ç :</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> readFile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">readDataset</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">&quot;utf8&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// do stuff with the data</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå¤„ç†é”™è¯¯çš„æ–¹å¼æ˜¯ä½¿ç”¨äº†å›è°ƒï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// do stuff with the data</span>
  <span class="token punctuation">}</span>
<span class="token comment">//</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½¿ç”¨<code>fs.readFile</code>è¯»å–ç»™å®šè·¯å¾„è€Œå¼•èµ·ä»»ä½•é”™è¯¯ï¼Œæˆ‘ä»¬å°†è·å¾—ä¸€ä¸ªé”™è¯¯å¯¹è±¡ã€‚</p><p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p><ul><li>ç®€å•çš„æŠŠå¯¹è±¡é”™è¯¯æ‰“å‡ºæ¥</li><li>æŠ›å‡ºé”™è¯¯</li><li>æŠŠé”™è¯¯ä¼ åˆ°å¦ä¸€ä¸ªå›è°ƒ</li></ul><p>æˆ‘ä»¬å¯ä»¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> readFile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">readDataset</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">&quot;utf8&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// do stuff with the data</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œä¸ DOM ä¸­çš„äº‹ä»¶å’Œå®šæ—¶å™¨ä¸€æ ·ï¼Œæ­¤å¼‚å¸¸å°†ä½¿ç¨‹åºå´©æºƒã€‚é€šè¿‡<code>try/catch</code>æ•è·å®ƒæ˜¯ä¸èµ·ä½œç”¨çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> readFile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">readDataset</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">&quot;utf8&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// do stuff with the data</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">readDataset</span><span class="token punctuation">(</span><span class="token string">&quot;not-here.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæˆ‘ä»¬ä¸æƒ³ä½¿ç¨‹åºå´©æºƒï¼Œåˆ™å°†é”™è¯¯ä¼ é€’ç»™å¦ä¸€ä¸ªå›è°ƒæ˜¯é¦–é€‰æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> readFile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">readDataset</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">&quot;utf8&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">errorHandler</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// do stuff with the data</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçš„<code>errorHandler</code>é¡¾åæ€ä¹‰ï¼Œæ˜¯ä¸€ä¸ªç”¨äºé”™è¯¯å¤„ç†çš„ç®€å•å‡½æ•°:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">errorHandler</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// do something with the error:</span>
  <span class="token comment">// - write to a log.</span>
  <span class="token comment">// - send to an external logger.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="node-js-ä¸­çš„å¼‚æ­¥é”™è¯¯å¤„ç†-event-emitters" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„å¼‚æ­¥é”™è¯¯å¤„ç†-event-emitters" aria-hidden="true">#</a> Node.js ä¸­çš„å¼‚æ­¥é”™è¯¯å¤„ç†ï¼ševent emitters</h2><p>åœ¨ Node.js ä¸­æ‰€åšçš„å¤§éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯åŸºäº<strong>äº‹ä»¶</strong>çš„ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<strong>emitter object</strong> å’Œä¸€äº›è§‚å¯Ÿè€…è¿›è¡Œäº¤äº’ä»¥ä¾¦å¬æ¶ˆæ¯ã€‚</p><p>Node.jsä¸­çš„ä»»ä½•äº‹ä»¶é©±åŠ¨æ¨¡å—ï¼ˆä¾‹å¦‚netï¼‰éƒ½æ‰©å±•äº†ä¸€ä¸ªåä¸º<code>EventEmitter</code>çš„æ ¹ç±»ã€‚</p><p>Node.jsä¸­çš„<strong>EventEmitter</strong>æœ‰ä¸¤ç§åŸºæœ¬æ–¹æ³•ï¼š<code>on</code>å’Œ<code>emit</code>ã€‚</p><p>è€ƒè™‘ä»¥ä¸‹ç®€å•çš„ HTTP æœåŠ¡å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;net&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8081</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;listening&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server listening!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;connection&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Client connected!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello client!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬æ¥å¬ä¸¤ä¸ªäº‹ä»¶:<code>listening</code> å’Œ<code>connection</code>ã€‚é™¤äº†è¿™äº›äº‹ä»¶ä¹‹å¤–ï¼Œevent emitters è¿˜å…¬å¼€ä¸€ä¸ª <code>error</code> äº‹ä»¶ï¼Œä»¥é˜²å‘ç”Ÿé”™è¯¯ã€‚</p><p>å¦‚æœåœ¨ç«¯å£80ä¸Šè¿è¡Œè¿™æ®µä»£ç ï¼Œè€Œä¸æ˜¯åœ¨å‰é¢çš„ç¤ºä¾‹ä¸Šä¾¦å¬ï¼Œå°†ä¼šå¾—åˆ°ä¸€ä¸ªå¼‚å¸¸ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;net&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;listening&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server listening!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;connection&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Client connected!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Hello client!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>events<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">291</span>
      <span class="token keyword">throw</span> er<span class="token punctuation">;</span> <span class="token comment">// Unhandled &#39;error&#39; event</span>
      <span class="token operator">^</span>

<span class="token literal-property property">Error</span><span class="token operator">:</span> listen <span class="token constant">EACCES</span><span class="token operator">:</span> permission denied <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">80</span>
Emitted <span class="token string">&#39;error&#39;</span> event on Server instance at<span class="token operator">:</span> <span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¦æ•è·å®ƒï¼Œæˆ‘ä»¬å¯ä»¥æ³¨å†Œä¸€ä¸ª<code>error</code>äº‹ä»¶å¤„ç†ç¨‹åºï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>listen <span class="token constant">EACCES</span><span class="token operator">:</span> permission denied <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>åœ¨è¿™ä¸ªæŒ‡å—ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†JavaScriptçš„å„ç§é”™è¯¯å¤„ç†ï¼Œä»ç®€å•çš„åŒæ­¥ä»£ç åˆ°é«˜çº§çš„å¼‚æ­¥ã€‚åœ¨JavaScriptç¨‹åºä¸­ï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ¥æ•è·å¼‚å¸¸ã€‚</p><p>åŒæ­¥ä»£ç ä¸­çš„å¼‚å¸¸æ˜¯æœ€å®¹æ˜“æ•è·çš„ã€‚ç›¸åï¼Œå¼‚æ­¥ä¸­çš„å¼‚å¸¸éœ€è¦ä¸€äº›æŠ€å·§æ¥å¤„ç†ã€‚</p><p>æµè§ˆå™¨ä¸­çš„æ–°JavaScript APIå‡ ä¹éƒ½åå‘ <code>Promise</code>ã€‚<code>then/catch/finally</code>æˆ–<code>try/catch</code>çš„æ¨¡å¼å¯¹äº<code>async/await</code>çš„å¼‚å¸¸å¤„ç†å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p>`,258),o=[p];function c(i,l){return s(),a("div",null,o)}const d=n(t,[["render",c],["__file","JavaScript é”™è¯¯å¤„ç†æŒ‡å—.html.vue"]]);export{d as default};
