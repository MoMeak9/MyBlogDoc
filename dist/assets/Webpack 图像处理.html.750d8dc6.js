import{_ as p}from"./_plugin-vue_export-helper.cdc0426e.js";import{o,c as l,a as n,b as s,d as e,e as t,r}from"./app.d7b34baa.js";const i={},c=n("h1",{id:"webpack-图像处理",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#webpack-图像处理","aria-hidden":"true"},"#"),s(" Webpack 图像处理")],-1),u=n("p",null,"参考来源：",-1),d={href:"https://juejin.cn/book/7115598540721618944",target:"_blank",rel:"noopener noreferrer"},k=n("h2",{id:"在-webpack-4-中导入图像",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#在-webpack-4-中导入图像","aria-hidden":"true"},"#"),s(" 在 Webpack 4 中导入图像")],-1),v=n("p",null,[s("原生 Webpack 4 只能处理标准 JavaScript 模块，因此需要借助 Loader —— 例如 "),n("code",null,"file-loader"),s("、"),n("code",null,"url-loader"),s("、"),n("code",null,"raw-loader"),s(" 等完成图像加载操作，实践中我们通常需要按资源类型选择适当加载器，简单介绍：")],-1),m={href:"https://link.juejin.cn/?target=https%3A%2F%2Fv4.webpack.js.org%2Floaders%2Ffile-loader%2F",target:"_blank",rel:"noopener noreferrer"},g=t(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|jpg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;file-loader&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>经过 <code>file-loader</code> 处理后，原始图片会被重命名并复制到产物文件夹，同时在代码中插入图片 URL 地址，形如：</p><p><img src="https://cdn.yihuiblog.top/images/202208170926876.webp" alt="image.png"></p>`,3),b={href:"https://link.juejin.cn/?target=https%3A%2F%2Fv4.webpack.js.org%2Floaders%2Furl-loader%2F",target:"_blank",rel:"noopener noreferrer"},h=n("code",null,"limit",-1),_=n("code",null,"file-loader",-1),F=t(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|jpg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;url-loader&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">1024</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>经过 <code>url-loader</code> 处理后，小于 <code>limit</code> 参数即 1024B 的图片会被转译为 Base64 编码（URL Data）</p><p>对于超过 <code>limit</code> 值的图片则直接调用 <code>file-loader</code> 完成加载。</p><p><code>url-loader</code> 同样适用于大多数图片格式，且能将许多细小的图片直接内嵌进产物中，减少页面运行时需要发出的网络请求数，<strong>在 HTTP 1.1 及之前版本中能带来正向的性能收益。</strong></p>`,4),j={href:"https://link.juejin.cn/?target=https%3A%2F%2Fv4.webpack.js.org%2Floaders%2Fraw-loader",target:"_blank",rel:"noopener noreferrer"},f=t(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.svg$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;raw-loader&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>经过 <code>raw-loader</code> 处理后，SVG 资源会被直接复制成字符串形式：</p><p><img src="https://cdn.yihuiblog.top/images/202208170930280.webp" alt="image.png"></p>`,3),y=n("p",null,[s("提示：除 "),n("code",null,"raw-loader"),s(" 外，我们还可以使用如下 Loader 加载 SVG 资源：")],-1),w={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fsvg-inline-loader",target:"_blank",rel:"noopener noreferrer"},x={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fsvg-url-loader",target:"_blank",rel:"noopener noreferrer"},q={href:"https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FBasics_of_HTTP%2FData_URIs",target:"_blank",rel:"noopener noreferrer"},A={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Freact-svg-loader",target:"_blank",rel:"noopener noreferrer"},z={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40svgr%2Fwebpack",target:"_blank",rel:"noopener noreferrer"},T={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fvue-svg-loader",target:"_blank",rel:"noopener noreferrer"},S=n("h2",{id:"在-webpack-5-中导入图像",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#在-webpack-5-中导入图像","aria-hidden":"true"},"#"),s(" 在 Webpack 5 中导入图像")],-1),P=n("p",null,[s("上述 "),n("code",null,"file-loader"),s("、"),n("code",null,"url-loader"),s("、"),n("code",null,"raw-loader"),s(" 都并不局限于处理图片，它们还可以被用于加载任意类型的多媒体或文本文件，使用频率极高，所以 "),n("strong",null,"Webpack5 直接内置了这些能力，开箱即可使用。")],-1),W=n("code",null,"module.rules.type",-1),L={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwebpack.js.org%2Fguides%2Fasset-modules%2F",target:"_blank",rel:"noopener noreferrer"},G=t(`<ul><li><code>file-loader</code> 对标到 <code>type = &quot;asset/resource&quot;&#39;</code>：</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|jpg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
<span class="token operator">-</span>     use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;file-loader&#39;</span><span class="token punctuation">]</span>
<span class="token operator">+</span>     type<span class="token operator">:</span> <span class="token string">&#39;asset/resource&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>url-loader</code> 对标到 <code>type = &quot;asset&quot;</code> 或 <code>type = &quot;asset/inline&quot;</code>：<strong>（亦可进行性能优化）</strong></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|jpg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
<span class="token operator">-</span>     use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
<span class="token operator">-</span>       loader<span class="token operator">:</span> <span class="token string">&#39;url-loader&#39;</span><span class="token punctuation">,</span>
<span class="token operator">-</span>       options<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token operator">-</span>         limit<span class="token operator">:</span> <span class="token number">1024</span>
<span class="token operator">-</span>       <span class="token punctuation">}</span>
<span class="token operator">-</span>     <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token operator">+</span>     type<span class="token operator">:</span> <span class="token string">&quot;asset&quot;</span><span class="token punctuation">,</span>
<span class="token operator">+</span>     parser<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>        dataUrlCondition<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>          maxSize<span class="token operator">:</span> <span class="token number">1024</span> <span class="token comment">// 1kb</span>
<span class="token operator">+</span>        <span class="token punctuation">}</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),H={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwebpack.js.org%2Fconfiguration%2Fmodule%2F%23ruleparserdataurlcondition",target:"_blank",rel:"noopener noreferrer"},N=n("code",null,"url-loader",-1),V=n("code",null,"limit",-1),C=t(`<ul><li><code>raw-loader</code> 对标到 <code>type = &quot;asset/source&quot;</code>：</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.svg$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
<span class="token operator">-</span>       use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;raw-loader&#39;</span><span class="token punctuation">]</span>
<span class="token operator">+</span>       type<span class="token operator">:</span> <span class="token string">&quot;asset/source&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),M=n("code",null,"module.rules.type",-1),R={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwebpack.js.org%2Fguides%2Fasset-modules%2F",target:"_blank",rel:"noopener noreferrer"},B={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwebpack.js.org%2Fconfiguration%2Fmodule%2F%23ruletype",target:"_blank",rel:"noopener noreferrer"},U=n("code",null,"module.rules.type",-1),$=t('<h2 id="图像优化-压缩" tabindex="-1"><a class="header-anchor" href="#图像优化-压缩" aria-hidden="true">#</a> 图像优化：压缩</h2><p>前面介绍的 Loader 与 Asset Modules 都只是解决了图像资源加载 —— 也就是让 Webpack 能够理解、处理图像资源，现实中我们还需要为 Web 页面中的图片做各种优化，提升页面性能，常见的优化方法包括：</p><ul><li><strong>图像压缩</strong>：减少网络上需要传输的流量；</li><li><strong>雪碧图</strong>：减少 HTTP 请求次数；</li><li><strong>响应式图片</strong>：根据客户端设备情况下发适当分辨率的图片，有助于减少网络流量；</li><li><strong>CDN</strong>：减少客户端到服务器之间的物理链路长度，提升传输效率；</li><li>等等。</li></ul><p>这其中有不少可以在开发、构建阶段借助 Webpack 搭建自动优化工作流，例如：图像压缩。</p>',4),D={href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Ftcoopman%2Fimage-webpack-loader",target:"_blank",rel:"noopener noreferrer"},I={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fimagemin-webpack-plugin",target:"_blank",rel:"noopener noreferrer"},J={href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fwebpack-contrib%2Fimage-minimizer-webpack-plugin",target:"_blank",rel:"noopener noreferrer"},E={href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Ftcoopman%2Fimage-webpack-loader",target:"_blank",rel:"noopener noreferrer"},O={href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Ftcoopman%2Fimage-webpack-loader",target:"_blank",rel:"noopener noreferrer"},Q={href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fimagemin%2Fimagemin",target:"_blank",rel:"noopener noreferrer"},K={href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fimagemin%2Fimagemin-mozjpeg",target:"_blank",rel:"noopener noreferrer"},X={href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fkevva%2Fimagemin-optipng",target:"_blank",rel:"noopener noreferrer"},Y={href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fimagemin%2Fimagemin-pngquant",target:"_blank",rel:"noopener noreferrer"},Z={href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fkevva%2Fimagemin-svgo",target:"_blank",rel:"noopener noreferrer"},nn={href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fkevva%2Fimagemin-gifsicle",target:"_blank",rel:"noopener noreferrer"},sn={href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fimagemin%2Fimagemin-webp",target:"_blank",rel:"noopener noreferrer"},an=n("h2",{id:"图像优化-雪碧图",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#图像优化-雪碧图","aria-hidden":"true"},"#"),s(" 图像优化：雪碧图")],-1),en=n("p",null,"在 HTTP 2 之前，HTTP 请求-响应是一种性能低下的通讯模型，即使是为了请求一个非常少的数据，也可能需要完整经历：建立 TCP 连接 => 发送 HTTP 请求 => 服务端处理 => 返回响应数据整个过程，加之 HTTP 协议的队首阻塞、浏览器并发请求数限制等原因，迫使我们必须尽量减少 HTTP 请求数以提升网络通讯效率。",-1),tn=n("code",null,"background-position",-1),pn=n("strong",null,"雪碧图",-1),on={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fwebpack-spritesmith",target:"_blank",rel:"noopener noreferrer"},ln=n("strong",null,"插件",-1),rn=t(`<p><strong>配置：</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;assets&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">SpritesmithPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 需要</span>
      <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">cwd</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;src/icons&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">glob</span><span class="token operator">:</span> <span class="token string">&#39;*.png&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">image</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;src/assets/sprite.png&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">css</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;src/assets/sprite.less&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),cn={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fwebpack-spritesmith",target:"_blank",rel:"noopener noreferrer"},un=n("code",null,"src.cwd",-1),dn=n("code",null,"src.glob",-1),kn=n("code",null,"target.image",-1),vn=t(`<div class="language-lua line-numbers-mode" data-ext="lua"><pre class="language-lua"><code>load<span class="token operator">-</span>img
├─ src
│  ├─ icons
│  │  ├─ grunt<span class="token punctuation">.</span>png
│  │  ├─ gulp<span class="token operator">-</span>js<span class="token punctuation">.</span>png
│  │  └─ webpack<span class="token punctuation">.</span>png
│  └─ index<span class="token punctuation">.</span>js
├─ webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
└─ package<span class="token punctuation">.</span>json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>提示：雪碧图曾经是一种使用广泛的性能优化技术，但 HTTP2 实现 TCP 多路复用之后，雪碧图的优化效果已经微乎其微 —— 甚至是反优化，可以预见随 HTTP2 普及率的提升，未来雪碧图的必要性会越来越低，因此建议读者们了解作用与基本原理即可，不必深究。</p></blockquote><h2 id="图像优化-响应式图片" tabindex="-1"><a class="header-anchor" href="#图像优化-响应式图片" aria-hidden="true">#</a> 图像优化：响应式图片</h2>`,3),mn={href:"https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FLearn%2FHTML%2FMultimedia_and_embedding%2FResponsive_images",target:"_blank",rel:"noopener noreferrer"},gn={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fresize-image-loader",target:"_blank",rel:"noopener noreferrer"},bn={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fhtml-loader-srcset",target:"_blank",rel:"noopener noreferrer"},hn={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fresponsive-loader",target:"_blank",rel:"noopener noreferrer"},_n={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fresponsive-loader",target:"_blank",rel:"noopener noreferrer"},Fn=t(`<div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>yarn <span class="token keyword">add</span> <span class="token operator">-</span>D responsive<span class="token operator">-</span>loader sharp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>之后，修改配置：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|jpg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">oneOf</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;javascript/auto&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">resourceQuery</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">sizes?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;responsive-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">adapter</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;responsive-loader/sharp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;asset/resource&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意，实践中我们通常没必要对项目里所有图片都施加响应式特性，因此这里使用 <code>resourceQuery</code> 过滤出带 <code>size/sizes</code> 参数的图片引用，使用方法：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 引用图片，并设置响应式参数</span>
<span class="token keyword">import</span> responsiveImage <span class="token keyword">from</span> <span class="token string">&#39;./webpack.jpg?sizes[]=300,sizes[]=600,sizes[]=1024&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Picture</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>img
      srcSet<span class="token operator">=</span><span class="token punctuation">{</span>responsiveImage<span class="token punctuation">.</span>srcSet<span class="token punctuation">}</span>
      src<span class="token operator">=</span><span class="token punctuation">{</span>responsiveImage<span class="token punctuation">.</span>src<span class="token punctuation">}</span>
      sizes<span class="token operator">=</span><span class="token string">&quot;(min-width: 1024px) 1024px, 100vw&quot;</span>
      loading<span class="token operator">=</span><span class="token string">&quot;lazy&quot;</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),jn=n("code",null,"'./webpack.jpg?sizes[]=300,sizes[]=600,sizes[]=1024';",-1),fn=n("code",null,"img",-1),yn={href:"https://developer.mozilla.org/zh-CN/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images",target:"_blank",rel:"noopener noreferrer"},wn=t(`<p>此外，我们还能简单地通过 <code>size</code> 参数精确控制不同条件下的图像尺寸：</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token selector">.foo</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">&quot;./webpack.jpg?size=1024&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 480px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
    <span class="token selector">.foo</span> <span class="token punctuation">{</span>
        <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">&quot;./webpack.jpg?size=300&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),xn={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fresponsive-loader",target:"_blank",rel:"noopener noreferrer"},qn=n("h2",{id:"总结",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#总结","aria-hidden":"true"},"#"),s(" 总结")],-1),An=n("code",null,"file-loader",-1),zn=n("code",null,"url-loader",-1),Tn={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwebpack.js.org%2Fguides%2Fasset-modules%2F",target:"_blank",rel:"noopener noreferrer"},Sn=n("code",null,"module.rules.type",-1),Pn=n("p",null,"在加载之外，我们还可以借助 Webpack 生态一系列组件低成本实现图像压缩、雪碧图、响应式图片等优化措施",-1),Wn=n("p",null,"阅读：",-1),Ln={href:"https://developer.mozilla.org/zh-CN/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images",target:"_blank",rel:"noopener noreferrer"};function Gn(Hn,Nn){const a=r("ExternalLinkIcon");return o(),l("div",null,[c,n("blockquote",null,[u,n("p",null,[n("a",d,[s("Webpack5 核心原理与应用实践"),e(a)])])]),k,v,n("ul",null,[n("li",null,[n("a",m,[s("file-loader"),e(a)]),s("：将图像引用转换为 url 语句并生成相应图片文件，例如使用如下配置：")])]),g,n("ul",null,[n("li",null,[n("a",b,[s("url-loader"),e(a)]),s("：有两种表现，对于小于阈值 "),h,s(" 的图像直接转化为 base64 编码；大于阈值的图像则调用 "),_,s(" 进行加载，例如如下配置：")])]),F,n("ul",null,[n("li",null,[n("a",j,[s("raw-loader"),e(a)]),s("：不做任何转译，只是简单将文件内容复制到产物中，适用于 SVG 场景，例如如下配置：")])]),f,n("blockquote",null,[y,n("ul",null,[n("li",null,[n("a",w,[s("svg-inline-loader"),e(a)]),s("：能够自动删除 SVG 图片中与显式无关的各种原信息，达到压缩效果；")]),n("li",null,[n("a",x,[s("svg-url-loader"),e(a)]),s("：以 "),n("a",q,[s("DataURL"),e(a)]),s(" 方式导入 SVG 图片，相比于 Base64 更节省空间；")]),n("li",null,[n("a",A,[s("react-svg-loader"),e(a)]),s("：导入 SVG 图片并自动转化为 React 组件形态，效果类似 "),n("a",z,[s("@svgr/webpack"),e(a)]),s("；")]),n("li",null,[n("a",T,[s("vue-svg-loader"),e(a)]),s("：导入 SVG 图片并自动转化为 Vue 组件形态。")])])]),S,P,n("p",null,[s("用法上，原本需要安装、导入 Loader，Webpack5 之后只需要通过 "),W,s(" 属性指定"),n("a",L,[s("资源类型"),e(a)]),s("即可，对比来看：")]),G,n("p",null,[s("其中，"),n("a",H,[s("module.rules.parser.dataUrlCondition"),e(a)]),s(" 用于限定文件大小阈值，对标 "),N,s(" 的 "),V,s(" 属性。")]),C,n("p",null,[s("引入 "),M,s(" 并不只是为了取代 Loader 那么简单，更重要的目的是在 JavaScript Module 之外增加对其它资源 —— "),n("a",R,[s("Asset Module"),e(a)]),s(" 的原生支持，让 Webpack 有机会介入这些多媒体资源的解析、生成过程，从而有机会实现更标准、高效的资源处理模型。")]),n("p",null,[s("目前 "),n("a",B,[U,e(a)]),s(" 已经支持 JSON、WebAssemsbly、二进制、文本等资源类型，后续支持更多。")]),$,n("p",null,[s("在 Webpack 生态中有不少优秀的图像压缩组件，包括："),n("a",D,[s("image-webpack-loader"),e(a)]),s("、"),n("a",I,[s("imagemin-webpack-plugin"),e(a)]),s("、"),n("a",J,[s("image-minimizer-webpack-plugin"),e(a)]),s(" 等")]),n("p",null,[n("strong",null,[n("u",null,[n("a",E,[s("image-webpack-loader"),e(a)]),s(" 组件功能齐全且用法简单，更推荐使用。")])])]),n("p",null,[n("a",O,[s("image-webpack-loader"),e(a)]),s(" 底层依赖于 "),n("a",Q,[s("imagemin"),e(a)]),s(" 及一系列的图像优化工具：")]),n("ul",null,[n("li",null,[n("a",K,[s("mozjpeg"),e(a)]),s("：用于压缩 JPG(JPEG) 图片；")]),n("li",null,[n("a",X,[s("optipng"),e(a)]),s("：用于压缩 PNG 图片；")]),n("li",null,[n("a",Y,[s("pngquant"),e(a)]),s("：同样用于压缩 PNG 图片；")]),n("li",null,[n("a",Z,[s("svgo"),e(a)]),s("：用于压缩 SVG 图片；")]),n("li",null,[n("a",nn,[s("gifsicle"),e(a)]),s("：用于压缩 Gif 图；")]),n("li",null,[n("a",sn,[s("webp"),e(a)]),s("：用于将 JPG/PNG 图压缩并转化为 WebP 图片格式。")])]),an,en,n("p",null,[s("例如，我们可以将许多细小的图片合并成一张大图 —— 从而将复数次请求合并为一次请求，之后配合 CSS 的 "),tn,s(" 控制图片的可视区域，这种技术被称作“"),pn,s("”。在 Webpack 中，我们可以使用 "),n("a",on,[s("webpack-spritesmith"),e(a)]),s(),ln,s("自动实现雪碧图效果。")]),rn,n("p",null,[s("关键在于，"),n("a",cn,[s("webpack-spritesmith"),e(a)]),s(" 插件会将 "),un,s(" 目录内所有匹配 "),dn,s(" 规则的图片合并成一张大图并保存到 "),kn,s(" 指定的文件路径，同时生成兼容 SASS/LESS/Stylus 预处理器的 mixins 代码，例如对于下面文件结构：")]),vn,n("p",null,[s("移动互联网时代，我们需要面对的客户端设备越来越多样复杂，分辨率从 PC 到平板电脑再到移动终端跨度极大。这会带来一个问题：同一张图片(主要是位图)在不同设备中，如果显示尺寸大于原始尺寸，最终效果会有明显颗粒感；而如果显示尺寸小于原始尺寸，又会造成带宽浪费。理想的解决方案是为不同设备提供不同的分辨率、不同尺寸的图片 —— 也就是所谓的"),n("a",mn,[s("响应式图片"),e(a)]),s("。")]),n("p",null,[s("Webpack 中有不少能够自动生成响应式图片的组件，例如： "),n("a",gn,[s("resize-image-loader"),e(a)]),s("、"),n("a",bn,[s("html-loader-srcset"),e(a)]),s("、"),n("a",hn,[s("responsive-loader"),e(a)]),s(" 等，以 "),n("a",_n,[s("responsive-loader"),e(a)]),s(" 为例，首先安装依赖")]),Fn,n("p",null,[s("上例的引用参数 "),jn,s(" 最终将生成宽度分别为 300、600、1024 三张图片，之后设置 "),fn,s(" 标签的 "),n("a",yn,[s("srcset"),e(a)]),s(" 属性即可实现图片响应式功能。")]),wn,n("blockquote",null,[n("p",null,[s("提示：除本文提及的基本功能外，"),n("a",xn,[s("responsive-loader"),e(a)]),s(" 还提供了许多用于控制产物、压缩比等特性的配置项")])]),qn,n("p",null,[s("在 Webpack 5 之前，我们需要使用 "),An,s("、"),zn,s(" 等 Loader 加载图片或其它多媒体资源文件，这些加载器各有侧重点，需要根据实际场景择优选用；而 Webpack 5 之后引入了 "),n("a",Tn,[s("Asset Module"),e(a)]),s(" 模型，自此我们只需要设置适当的 "),Sn,s(" 配置即可，不需要为多媒体资源专门引入 Loader。")]),Pn,Wn,n("p",null,[n("a",Ln,[s("响应式图片 MDN"),e(a)])])])}const Mn=p(i,[["render",Gn],["__file","Webpack 图像处理.html.vue"]]);export{Mn as default};
