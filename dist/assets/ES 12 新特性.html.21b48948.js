import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,e}from"./app.d7b34baa.js";const p={},t=e(`<h1 id="es-12-æ–°ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#es-12-æ–°ç‰¹æ€§" aria-hidden="true">#</a> ES 12 æ–°ç‰¹æ€§</h1><h2 id="é€»è¾‘èµ‹å€¼æ“ä½œç¬¦" tabindex="-1"><a class="header-anchor" href="#é€»è¾‘èµ‹å€¼æ“ä½œç¬¦" aria-hidden="true">#</a> é€»è¾‘èµ‹å€¼æ“ä½œç¬¦</h2><p>é€»è¾‘èµ‹å€¼æ“ä½œç¬¦å°†é€»è¾‘æ“ä½œ(<code>&amp;&amp;</code>ã€<code>||</code>æˆ–<code>??</code>)ä¸èµ‹å€¼è¡¨è¾¾å¼ç»„åˆåœ¨ä¸€èµ·ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>x <span class="token operator">||=</span> y<span class="token punctuation">;</span>
x <span class="token operator">||</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>

x <span class="token operator">&amp;&amp;=</span> y<span class="token punctuation">;</span>
x <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>


x <span class="token operator">??=</span> y<span class="token punctuation">;</span>
x <span class="token operator">??</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å¸¦æœ‰<code>&amp;&amp;</code>çš„é€»è¾‘èµ‹å€¼æ“ä½œç¬¦</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
x <span class="token operator">&amp;&amp;=</span> y<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>x &amp;&amp;= y</code> ç­‰ä»·äº <code>x &amp;&amp; (x = y)</code>ã€‚</p><p>æˆ–è€…ç­‰ä»·äº</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  x <span class="token operator">=</span> y
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸º<code>x</code>æ˜¯ä¸€ä¸ªçœŸå€¼ï¼Œæ‰€ä»¥å®ƒè¢«èµ‹å€¼ä¸º<code>y</code>ï¼Œå³<code>2</code>ã€‚</p><h3 id="å¸¦æœ‰-çš„é€»è¾‘èµ‹å€¼æ“ä½œç¬¦" tabindex="-1"><a class="header-anchor" href="#å¸¦æœ‰-çš„é€»è¾‘èµ‹å€¼æ“ä½œç¬¦" aria-hidden="true">#</a> <strong>å¸¦æœ‰<code>||</code>çš„é€»è¾‘èµ‹å€¼æ“ä½œç¬¦</strong></h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
x <span class="token operator">||=</span> y<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>x ||= y</code> ç­‰ä»·äº <code>x || (x = y)</code>ã€‚</p><p>è¿™æ„å‘³ç€èµ‹å€¼æ“ä½œåªåœ¨<code>x</code>ä¸ºè™šå€¼æ—¶æ‰ä¼šå‘ç”Ÿã€‚åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œ<code>x</code>åŒ…å«<code>1</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªçœŸå€¼ï¼Œå› æ­¤ï¼Œèµ‹å€¼ä¸ä¼šå‘ç”Ÿã€‚è¿™å°±æ˜¯æˆ‘ä»¬çš„ä»£ç åœ¨æ§åˆ¶å°ä¸­æ‰“å°<code>1</code>çš„åŸå› ã€‚</p><p>ç®€å•åœ°è¯´</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">updateID</span> <span class="token operator">=</span> <span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// æˆ‘ä»¬å¯ä»¥è¿™æ ·åš</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span> user<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span>

  <span class="token comment">// æˆ–è€…è¿™æ ·</span>
  user<span class="token punctuation">.</span>id <span class="token operator">=</span> user<span class="token punctuation">.</span>id <span class="token operator">||</span> <span class="token number">1</span>

  <span class="token comment">// æˆ–è€…è¿™æ ·</span>
  user<span class="token punctuation">.</span>id <span class="token operator">||=</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¸¦æœ‰-çš„é€»è¾‘èµ‹å€¼æ“ä½œç¬¦-1" tabindex="-1"><a class="header-anchor" href="#å¸¦æœ‰-çš„é€»è¾‘èµ‹å€¼æ“ä½œç¬¦-1" aria-hidden="true">#</a> <strong>å¸¦æœ‰<code>??</code>çš„é€»è¾‘èµ‹å€¼æ“ä½œç¬¦</strong></h3><p><code>??</code> åœ¨ JS ä¸­ä¸“é—¨æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸º <code>null</code> æˆ–<code>undefined</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> a<span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> a <span class="token operator">??</span> <span class="token number">5</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ç¬¬äºŒè¡Œï¼Œ<code>let b = a ?? 5</code>ï¼Œå¦‚æœ<code>a</code>çš„å€¼ä¸º<code>null</code> æˆ–<code>undefined</code>ï¼Œ<code>??</code>æ±‚å€¼å¹¶èµ‹å€¼ç»™<code>b</code>ã€‚</p><p>ç°åœ¨è€ƒè™‘<code>??</code> å’Œ<code>==</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> x<span class="token punctuation">;</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
x <span class="token operator">??=</span> y<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
x <span class="token operator">??=</span> y<span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string"> ç­‰ä»·äº </span><span class="token template-punctuation string">\`</span></span>x <span class="token operator">=</span> x <span class="token operator">??</span> <span class="token punctuation">(</span>x<span class="token operator">=</span>y<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ•°å­—åˆ†éš”ç¬¦" tabindex="-1"><a class="header-anchor" href="#æ•°å­—åˆ†éš”ç¬¦" aria-hidden="true">#</a> æ•°å­—åˆ†éš”ç¬¦</h2><p>å®ƒå…è®¸æˆ‘ä»¬åœ¨æ•°å­—ä¹‹é—´æ·»åŠ ä¸‹åˆ’çº¿(<code>_</code>)å­—ç¬¦ï¼Œä½¿æ•°å­—æ›´å…·å¯è¯»æ€§ã€‚</p><p>ä¾‹å¦‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token number">100000000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¢«0çš„æ•°é‡æ‰€è¿·æƒ‘</p><p>åˆ†éš”ç¬¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token number">100_000_000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åˆ†éš”ç¬¦å¯ä»¥ç”¨äºæ•°å­—çš„æ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token number">1_000_000.123_456</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åˆ†éš”ç¬¦ä¸ä»…å¯ä»¥ç”¨åœ¨æ•´æ•°å’Œæµ®ç‚¹æ•°ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨äºŒè¿›åˆ¶ã€åå…­è¿›åˆ¶ã€å…«è¿›åˆ¶å­—é¢é‡ä¸­ã€‚</p><p>åˆ†éš”ç¬¦ä¹Ÿé€‚ç”¨äºBigIntæ•°å­—ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> trillion <span class="token operator">=</span> <span class="token number">1000_000_000_000n</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>trillion<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;1000000000000&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ†éš”ç¬¦åªæ˜¯ä¸ºäº†å¯è¯»æ€§ã€‚æ‰€ä»¥ï¼Œå®ƒå¯ä»¥æ”¾åœ¨æ•°å­—å†…çš„ä»»ä½•åœ°æ–¹ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> amount <span class="token operator">=</span> <span class="token number">178_00</span><span class="token punctuation">;</span> <span class="token comment">// 00 after _ for cents.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="promise-any-ä¸-aggregateerror" tabindex="-1"><a class="header-anchor" href="#promise-any-ä¸-aggregateerror" aria-hidden="true">#</a> Promise.any ä¸ AggregateError</h2><p><code>Promise.any()</code>è¿”å›ç¬¬ä¸€ä¸ªå®Œæˆçš„promiseçš„å€¼ã€‚å¦‚æœæ‰€æœ‰ä¼ é€’ç»™<code>Promise.any()</code>ä½œä¸ºå‚æ•°(ä½œä¸ºæ•°ç»„)çš„Promiseéƒ½è¢«æ‹’ç»ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ª&quot;<code>AggregateError</code>&quot;å¼‚å¸¸ã€‚</p><p>AggregateError\`æ˜¯ä¸€ä¸ªæ–°çš„Errorå­ç±»ï¼Œå®ƒå¯¹å•ä¸ªé”™è¯¯è¿›è¡Œåˆ†ç»„ã€‚æ¯ä¸ªAggregateErrorå®ä¾‹éƒ½åŒ…å«ä¸€ä¸ªå¯¹å¼‚å¸¸æ•°ç»„çš„å¼•ç”¨ã€‚</p><p>è€ƒè™‘ä¸‹é¢ä¾‹å­ï¼š</p><p>ä¸‹é¢æˆ‘ä»¬æœ‰3ä¸ª promiseï¼Œå®ƒä»¬æ˜¯éšæœºçš„ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>p1</code>, <code>p2</code>å’Œ<code>p3</code>ä¸­ï¼Œæœ€å…ˆçš„å®Œæˆçš„çš„ç”±<code>Promise.any()</code>æ‰§è¡Œã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰“å° &quot;A&quot;, &quot;B&quot; æˆ–è€… &quot;C&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ‰€æœ‰çš„ promise éƒ½å¤±è´¥äº†?åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>Promise.any()</code>æŠ›å‡º<code>AggregateError</code>å¼‚å¸¸ã€‚æˆ‘ä»¬éœ€è¦æ•è·å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>errors<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†æ¼”ç¤ºçš„ç›®çš„ï¼Œåœ¨<code>Promise.any()</code>ä¸­æˆ‘ä»¬åªèƒ½å®ƒä¸€ä¸ª <code>promise</code>ã€‚è€Œè¿™ä¸ª promise æ˜¯å¤±è´¥çš„ã€‚ä¸Šè¿°ä»£ç åœ¨æ§åˆ¶å°ä¸­è®°å½•äº†ä»¥ä¸‹é”™è¯¯ã€‚</p><p><img src="https://my-doc-1259409954.file.myqcloud.com/MyImages/640" alt="å›¾ç‰‡"></p><h2 id="string-prototype-replaceall-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#string-prototype-replaceall-æ–¹æ³•" aria-hidden="true">#</a> String.prototype.replaceAll æ–¹æ³•</h2><p><code>String.prototype.replaceAll()</code>å…è®¸æˆ‘ä»¬ç”¨ä¸€ä¸ªä¸åŒçš„å€¼æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­ä¸²å®ä¾‹ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨å…¨å±€æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><p>ç›®å‰ï¼ŒJavaScriptå­—ç¬¦ä¸²æœ‰ä¸€ä¸ª<code>replace()</code>æ–¹æ³•ã€‚å®ƒå¯ä»¥ç”¨æ¥ç”¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²æ›¿æ¢ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">&quot;Backbencher sits at the Back&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newStr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;Back&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Front&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newStr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Frontbencher sits at the Back&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¾“å…¥æ¨¡å¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ<code>replace()</code>æ–¹æ³•åªæ›¿æ¢ç¬¬ä¸€æ¬¡å‡ºç°çš„å†…å®¹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä»£ç ä¸­ï¼Œ&quot;<code>Back</code>&quot;çš„ç¬¬äºŒæ¬¡å‡ºç°æ²¡æœ‰è¢«æ›¿æ¢ã€‚</p><p>åªæœ‰å°†æ¨¡å¼ä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼æä¾›æ—¶ï¼Œæ‰èƒ½è¿›è¡Œå®Œå…¨æ›¿æ¢ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">&quot;Backbencher sits at the Back&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newStr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Back</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;Front&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newStr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Frontbencher sits at the Front&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬æ¥çœ‹å¦ä¸€ä¸ªä¾‹å­</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> strWithPlus <span class="token operator">=</span> <span class="token string">&#39;++&#39;</span>
<span class="token keyword">const</span> strWithComma <span class="token operator">=</span> strWithPlus<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;, &#39;</span><span class="token punctuation">)</span>
<span class="token comment">// , , </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹æ³•éœ€è¦ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚ç„¶è€Œï¼Œå¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼å¾€å¾€æ˜¯é”™è¯¯çš„æ¥æºã€‚(æ²¡æœ‰äººå–œæ¬¢RegEx ğŸ˜¬)</p><p>è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨<code>String.prototype.split()</code>å’Œ<code>Array.prototype.join()</code>æ–¹æ³•</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> strWithPlus <span class="token operator">=</span> <span class="token string">&#39;++&#39;</span>
<span class="token keyword">const</span> strWithComma <span class="token operator">=</span> strWithPlus<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;+&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;, &#39;</span><span class="token punctuation">)</span>
<span class="token comment">// , , </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æ–¹æ³•é¿å…ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†æ˜¯å¿…é¡»å°†å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºå•ç‹¬çš„éƒ¨åˆ†(å•è¯)ï¼Œå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œç„¶åå°†æ•°ç»„å…ƒç´ è¿æ¥ä¸ºä¸€ä¸ªæ–°å­—ç¬¦ä¸²ã€‚</p><p><code>string.prototype.replaceAll()</code>è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œå¹¶ä¸ºå…¨å±€æ›¿æ¢å­ä¸²æä¾›äº†ç®€å•è€Œæ–¹ä¾¿çš„æ–¹å¼ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> strWithPlus <span class="token operator">=</span> <span class="token string">&#39;++&#39;</span>
<span class="token keyword">const</span> strWithComma <span class="token operator">=</span> strWithPlus<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&#39;+&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;, &#39;</span><span class="token punctuation">)</span>
<span class="token comment">// , ,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨å…¨å±€æ­£åˆ™è¡¨è¾¾å¼ä½œä¸ºæŸ¥æ‰¾å€¼ï¼Œé‚£ä¹ˆ<code>replace</code>å’Œ<code>replaceAll</code>çš„è¡Œä¸ºæ˜¯ä¸€æ ·çš„ã€‚</p></blockquote><h2 id="weakrefs-ä¸-finalizationregistry-å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#weakrefs-ä¸-finalizationregistry-å¯¹è±¡" aria-hidden="true">#</a> WeakRefs ä¸ FinalizationRegistry å¯¹è±¡</h2><p><code>WeakRef</code> æ˜¯å¼±å¼•ç”¨çš„æ„æ€ã€‚å¼±å¼•ç”¨çš„ä¸»è¦ç”¨é€”æ˜¯å®ç°å¤§å‹å¯¹è±¡çš„<strong>ç¼“å­˜æˆ–æ˜ å°„</strong>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›é•¿æœŸä¿ç•™å¤§é‡çš„å†…å­˜æ¥ä¿å­˜è¿™ç§å¾ˆå°‘ä½¿ç”¨çš„ç¼“å­˜æˆ–æ˜ å°„ã€‚æˆ‘ä»¬å¯ä»¥è®©å†…å­˜å¾ˆå¿«è¢«åƒåœ¾å›æ”¶ï¼Œä»¥åå¦‚æœæˆ‘ä»¬å†æ¬¡éœ€è¦å®ƒï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ç¼“å­˜ã€‚</p><p>JS æ˜¯ä¼šè‡ªåŠ¨åƒåœ¾æ”¶é›†ã€‚å¦‚æœä¸€ä¸ªå˜é‡ä¸å†å¯è¾¾ï¼ŒJS åƒåœ¾æ”¶é›†å™¨å°†è‡ªåŠ¨åˆ é™¤å®ƒã€‚ä½ å¯ä»¥åœ¨MDNä¸­é˜…è¯»æ›´å¤šå…³äº JS åƒåœ¾æ”¶é›†çš„å†…å®¹ã€‚</p><p>WeaseRefsï¼ˆå¼±å¼•ç”¨ï¼‰æä¾›äº†ä¸¤ä¸ªæ–°åŠŸèƒ½ï¼š</p><ul><li>ä½¿ç”¨<code>WeakRef</code>ç±»åˆ›å»ºå¯¹å¯¹è±¡çš„å¼±å¼•ç”¨</li><li>ä½¿ç”¨<code>FinalizationRegistry</code>ç±»åœ¨åƒåœ¾æ”¶é›†ä¹‹åè¿è¡Œè‡ªå®šä¹‰æ”¶é›†å™¨</li></ul><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>WeakRef</code>å…è®¸æˆ‘ä»¬åˆ›å»ºå¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œè¿™äº›å¯¹è±¡æ˜¯å¦ä¸€ä¸ªå¯¹è±¡çš„å±æ€§å€¼ï¼Œè€Œfinalizerså¯ä»¥ç”¨æ¥ï¼Œé™¤å…¶ä»–å¤–ï¼Œç§»é™¤å¯¹è¢«åƒåœ¾æ”¶é›†å™¨ &quot;æ¸…ç†&quot;è¿‡çš„å¯¹è±¡çš„å¼•ç”¨ã€‚</p><p>åœ¨åˆ›å»ºä½¿ç”¨å†…ç½®ç¼“å­˜çš„è®°å¿†åŒ–ï¼ˆmemoizationï¼‰å‡½æ•°æ—¶ï¼Œå¦‚æœç¼“å­˜ä¸­å­˜åœ¨ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°çš„è®¡ç®—å€¼ï¼Œè¿™ç§æŠ€æœ¯å¯èƒ½å¾ˆæœ‰ç”¨ï¼ˆå‰ææ˜¯å¯¹è±¡è¢«ç”¨ä½œç¼“å­˜å¯¹è±¡çš„å±æ€§å€¼ï¼Œä»¥åŠå®ƒä»¬éšåè¢«åˆ é™¤çš„é£é™©ï¼‰ï¼Œä»¥é˜²æ­¢é‡å¤æ‰§è¡Œå‡½æ•°ã€‚</p><p>åœ¨æ„å»ºå†…è”ç¼“å­˜æ—¶</p><ul><li>å¦‚æœæ²¡æœ‰å†…å­˜æ³„æ¼çš„é£é™©ï¼Œé‚£ä¹ˆä½¿ç”¨ <code>Map</code></li><li>å½“ä½¿ç”¨å¯ä»¥éšååˆ é™¤å¯¹è±¡çš„é”®æ—¶ï¼Œä½¿ç”¨ <code>WeakMap</code></li><li>å½“ä½¿ç”¨å¯ä»¥éšååˆ é™¤çš„å€¼å¯¹è±¡æ—¶ï¼Œè¯·å°†<code>Map</code>ä¸<code>WeakRef</code>ç»“åˆä½¿ç”¨</li></ul><p>ææ¡ˆä¸­æœ€åä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">makeWeakCached</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ref <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//     </span>
      <span class="token keyword">const</span> cached <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">deref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> cached<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> fresh <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token comment">//    ( )</span>
    cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">WeakRef</span><span class="token punctuation">(</span>fresh<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> fresh
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> getImageCached <span class="token operator">=</span> <span class="token function">makeWeakCached</span><span class="token punctuation">(</span>getImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>WeakRef</code>æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶è¿”å›å¯¹è¯¥å¯¹è±¡çš„å¼±å¼•ç”¨</li><li>WeakRef å®ä¾‹çš„<code>deref</code>æ–¹æ³•è¿”å›ä¸¤ä¸ªå€¼ä¸­çš„ä¸€ä¸ªã€‚</li></ul><p>åœ¨å†…ç½®ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œ<code>finalizer</code>è¢«è®¾è®¡ä¸ºåœ¨ä¸€ä¸ªå€¼å¯¹è±¡è¢«åƒåœ¾æ”¶é›†å™¨é”€æ¯åå®Œæˆæ¸…ç†è¿‡ç¨‹ï¼Œæˆ–è€…æ›´ç®€å•åœ°è¯´ï¼Œåˆ é™¤å¯¹è¿™æ ·ä¸€ä¸ªå¯¹è±¡çš„å¼±å¼•ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">makeWeakCached</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//    -   </span>
  <span class="token keyword">const</span> cleanup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FinalizationRegistry</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ref <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ref <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>ref<span class="token punctuation">.</span><span class="token function">deref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> cache<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ref <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> cached <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">deref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> cached
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> fresh <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">WeakRef</span><span class="token punctuation">(</span>fresh<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//      ( )</span>
    cleanup<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>fresh<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token keyword">return</span> fresh
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> getImageCached <span class="token operator">=</span> <span class="token function">makeWeakCached</span><span class="token punctuation">(</span>getImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,78),o=[t];function c(l,i){return s(),a("div",null,o)}const d=n(p,[["render",c],["__file","ES 12 æ–°ç‰¹æ€§.html.vue"]]);export{d as default};
