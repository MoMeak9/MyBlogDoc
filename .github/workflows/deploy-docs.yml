# 当代码推动到 dev 分支时，执行当前工作流程
# 更多配置信息: https://docs.github.com/cn/actions/getting-started-with-github-actions
# https://github.com/marketplace/actions/tencent-serverless-action
name: deploy serverless
on: #监听的事件和分支配置
   push:
     branches:
       - main
jobs:
   deploy:
     name: deploy serverless
     runs-on: ubuntu-latest
     steps:
       - name: clone local repository
         uses: actions/checkout@v3
       - name: 安装 pnpm
         uses: pnpm/action-setup@v2
         with:
           version: 6.7.0
       - name: 设置 Node.js
         uses: actions/setup-node@v2
         with:
           node-version: 16
           cache: pnpm
       - name: install dependency
         run: pnpm install --frozen-lockfile
       - name: 构建文档
         env:
           NODE_OPTIONS: --max_old_space_size=4096
         run: pnpm run docs:build
       - name: install serverless
         run: npm install -g serverless
       - name: deploy serverless
         run: sls deploy --force
         env: # 环境变量
           STAGE: prod #您的部署环境
           SERVERLESS_PLATFORM_VENDOR: tencent #serverless 境外默认为 aws，配置为腾讯
           TENCENT_SECRET_ID: ${{ secrets.TENCENT_SECRET_ID }} #您的腾讯云账号 sercret ID
           TENCENT_SECRET_KEY: ${{ secrets.TENCENT_SECRET_KEY }} #您的腾讯云账号 sercret key
